
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>User Guide &#8212; Open Network Install Environment  documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/onie-favicon-16x16.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Design Specification" href="../design-spec/index.html" />
    <link rel="prev" title="Project News" href="../news/index.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../design-spec/index.html" title="Design Specification"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../news/index.html" title="Project News"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
  <a href="
      ../index.html" class="logo">
  
  <img src="../_static/ONIE-logo-green-160x60.png" class="logo" />
  </a>
  <center><a href="https://github.com/opencomputeproject/onie" class="logo">
  <svg class="octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
  opencomputeproject/onie</a></center>

<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download/index.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-using-a-usb-thumb-drive">Installing using a USB thumb drive</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-over-the-network">Installing over the Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#directly-connected-scenario">Directly Connected Scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="#l2-connected-scenario">L2 Connected  Scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-dhcp-scenario-1-specify-installer-image-url">Basic DHCP Scenario 1 (Specify Installer Image URL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-dhcp-scenario-2-domain-name-server">Basic DHCP Scenario 2 (Domain Name Server)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#layer-3-network-scenario">Layer 3 Network Scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-dhcp-match-vendor-class-identifier">Advanced DHCP (Match Vendor Class Identifier)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-dhcp-2-vivso">Advanced DHCP 2 (VIVSO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#http-headers-and-scripting">HTTP Headers and Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-an-installation">Debugging an Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design-spec/index.html">Design Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">User Guide</a><ul>
<li><a class="reference internal" href="#installing-using-a-usb-thumb-drive">Installing using a USB thumb drive</a></li>
<li><a class="reference internal" href="#installing-over-the-network">Installing over the Network</a><ul>
<li><a class="reference internal" href="#installing-and-configuring-the-http-server">Installing and Configuring the HTTP Server</a></li>
<li><a class="reference internal" href="#copying-the-nos-installer-image-to-the-http-server">Copying the NOS Installer Image to the HTTP Server</a></li>
<li><a class="reference internal" href="#testing-the-nos-installer-download-from-the-http-server">Testing the NOS Installer Download from the HTTP Server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#directly-connected-scenario">Directly Connected Scenario</a></li>
<li><a class="reference internal" href="#l2-connected-scenario">L2 Connected  Scenario</a></li>
<li><a class="reference internal" href="#basic-dhcp-scenario-1-specify-installer-image-url">Basic DHCP Scenario 1 (Specify Installer Image URL)</a></li>
<li><a class="reference internal" href="#basic-dhcp-scenario-2-domain-name-server">Basic DHCP Scenario 2 (Domain Name Server)</a></li>
<li><a class="reference internal" href="#layer-3-network-scenario">Layer 3 Network Scenario</a></li>
<li><a class="reference internal" href="#advanced-dhcp-match-vendor-class-identifier">Advanced DHCP (Match Vendor Class Identifier)</a></li>
<li><a class="reference internal" href="#advanced-dhcp-2-vivso">Advanced DHCP 2 (VIVSO)</a></li>
<li><a class="reference internal" href="#http-headers-and-scripting">HTTP Headers and Scripting</a></li>
<li><a class="reference internal" href="#debugging-an-installation">Debugging an Installation</a><ul>
<li><a class="reference internal" href="#verify-web-server-configuration">Verify Web Server Configuration</a></li>
<li><a class="reference internal" href="#try-direct-connection">Try Direct Connection</a></li>
<li><a class="reference internal" href="#inspect-dhcp-server-logs">Inspect DHCP Server Logs</a></li>
<li><a class="reference internal" href="#use-tcpdump">Use TCPDUMP</a></li>
<li><a class="reference internal" href="#simplify-dhcp-configuration">Simplify DHCP Configuration</a></li>
<li><a class="reference internal" href="#add-a-remote-syslog-server">Add a Remote Syslog Server</a></li>
<li><a class="reference internal" href="#log-in-to-the-target-switch">Log In to the Target Switch</a></li>
<li><a class="reference internal" href="#connect-to-the-serial-console">Connect to the Serial Console</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Home</a></li>
              
              <li>User Guide</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="user-guide">
<span id="id1"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>ONIE supports a number of methods for locating a Network Operating
System (NOS) installer image.  The methods range from <strong>really easy</strong> to
<strong>rather complex</strong>.</p>
<p>The easy methods are suitable for installing an NOS on a small number
of switches as a proof of concept or for a demo.  These methods, while
easy to set up, offer limited configurable options that more complex
networks may require.</p>
<p>The more complex methods are suitable for complex networks and large
scale switch deployment scenarios.  These methods offer a wide range
of flexible options, with the downside being you need to understand
and configure these options.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The examples throughout this section reference a
hypothetical PowerPC-based switch, called <strong>MACHINE</strong>, manufactured by a
hypothetical hardware manufacturer, called <strong>VENDOR</strong>.</p>
</div>
<div class="section" id="installing-using-a-usb-thumb-drive">
<h2>Installing using a USB thumb drive<a class="headerlink" href="#installing-using-a-usb-thumb-drive" title="Permalink to this headline">¶</a></h2>
<p>To install via USB simply copy the installer image to the <em>root</em>
directory of the USB thumb drive, using the file name
<code class="docutils literal notranslate"><span class="pre">onie-installer</span></code>.</p>
<p>For the purposes of this guide, assume the the NOS installer image is
named <code class="docutils literal notranslate"><span class="pre">ACME_XYZ1234_PowerPC_Installer.bin</span></code>.  Let’s assume the USB
drive shows up at /dev/sdd1 under Linux (it might be different on your
system and OS).</p>
<p>Copy the installer file to the root of the USB thumb drive like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>linux:~$ sudo mkdir /mnt/usb
linux:~$ sudo mount /dev/sdd1 /mnt/usb
linux:~$ sudo cp ACME_XYZ1234_PowerPC_Installer.bin /mnt/usb/onie-installer
linux:~$ sudo umount /mnt/usb
</pre></div>
</div>
<p>Now remove the USB drive from your computer and insert it into the USB
port on the front (or rear) panel of your ONIE enabled device.  Power
on the device and ONIE will discover the <code class="docutils literal notranslate"><span class="pre">onie-installer</span></code> file on
the root of the USB drive and execute it.</p>
</div>
<div class="section" id="installing-over-the-network">
<h2>Installing over the Network<a class="headerlink" href="#installing-over-the-network" title="Permalink to this headline">¶</a></h2>
<p>For all network installation scenarios, ONIE expects the NOS installer
image to be available on the network via HTTP.  This guide assumes the
following hostname and IPv4 address of the Web server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span><span class="p">:</span>  <span class="n">image</span><span class="o">-</span><span class="n">server</span>
<span class="n">IP</span> <span class="n">addr</span> <span class="p">:</span>  <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.10</span>
</pre></div>
</div>
<p>Before continuing, the following resources must be set up:</p>
<ul class="simple">
<li>Install and configure an HTTP server.</li>
<li>Copy the NOS installer image to the HTTP server.</li>
</ul>
<div class="section" id="installing-and-configuring-the-http-server">
<h3>Installing and Configuring the HTTP Server<a class="headerlink" href="#installing-and-configuring-the-http-server" title="Permalink to this headline">¶</a></h3>
<p>Download and install your favorite HTTP server <a class="footnote-reference" href="#apache-httpd" id="id2">[3]</a>
<a class="footnote-reference" href="#nginx" id="id3">[4]</a>.</p>
<p>The examples in this guide assume Apache httpd is installed on a Linux
machine with the default configuration options.  The document root of
the Web server is <code class="docutils literal notranslate"><span class="pre">/var/www</span></code>.</p>
</div>
<div class="section" id="copying-the-nos-installer-image-to-the-http-server">
<h3>Copying the NOS Installer Image to the HTTP Server<a class="headerlink" href="#copying-the-nos-installer-image-to-the-http-server" title="Permalink to this headline">¶</a></h3>
<p>After procuring your NOS installer image from your NOS vendor, copy the
installer to the document root of your Web server.  In the case of
Apache on Linux, the document root directory is <code class="docutils literal notranslate"><span class="pre">/var/www</span></code>.  You
probably need root privileges to copy files there.</p>
<p>For the purposes of this guide, assume the the NOS installer image is
named <code class="docutils literal notranslate"><span class="pre">ACME_XYZ1234_PowerPC_Installer.bin</span></code>.  After copying this file
to the document root of the Web server, the contents of <code class="docutils literal notranslate"><span class="pre">/var/www</span></code>
should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>image-server:~$ sudo cp ACME_XYZ1234_PowerPC_Installer.bin /var/www
image-server:~$ ls -l /var/www
-rw-r--r-- 1 root root  17755 Jun 27 16:18 ACME_XYZ1234_PowerPC_Installer.bin
</pre></div>
</div>
</div>
<div class="section" id="testing-the-nos-installer-download-from-the-http-server">
<span id="test-http-server"></span><h3>Testing the NOS Installer Download from the HTTP Server<a class="headerlink" href="#testing-the-nos-installer-download-from-the-http-server" title="Permalink to this headline">¶</a></h3>
<p>Before proceeding, it is a good idea to double check the configuration
of the Web server and the location of the NOS installer image.  From
another machine, try to download the NOS installer image.  You could
use a Web browser or a CLI command like <code class="docutils literal notranslate"><span class="pre">wget</span></code> (<a class="footnote-reference" href="#wget" id="id4">[5]</a>) or <code class="docutils literal notranslate"><span class="pre">curl</span></code>
(<a class="footnote-reference" href="#curl" id="id5">[6]</a>).</p>
<p>The URLs to double check are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.10</span><span class="o">/</span><span class="n">ACME_XYZ1234_PowerPC_Installer</span><span class="o">.</span><span class="n">bin</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">image</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">ACME_XYZ1234_PowerPC_Installer</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="directly-connected-scenario">
<span id="directly-connected"></span><h2>Directly Connected Scenario<a class="headerlink" href="#directly-connected-scenario" title="Permalink to this headline">¶</a></h2>
<p>The most simple topology is when the Web server is directly connected
to the Ethernet management port on the target switch, as depicted in the
following diagram.</p>
<div class="figure align-center" id="id17">
<a class="reference internal image-reference" href="../_images/direct-connect.png"><img alt="Switch and Web Server Directly Connected" src="../_images/direct-connect.png" style="width: 447.75px; height: 136.5px;" /></a>
<p class="caption"><span class="caption-text">Switch and Web Server Directly Connected</span></p>
</div>
<p>This simple configuration is appropriate for provisioning a small
number of switches without relying on a lot of infrastructure.  You
might have this scenario in a production environment when you wheel a
crash cart up to a switch in a rack and need to perform a quick
one-off install.</p>
<p>In this scenario, without any additional configuration, ONIE will
discover the IP address (either IPv6 or IPv4) of the link local Web
server.  See the <a class="reference internal" href="../design-spec/discovery.html#discover-neighbors"><span class="std std-ref">HTTP IPv4 and IPv6 Neighbors</span></a> section for more on how
ONIE discovers its link local neighbors.</p>
<p>After neighbor discovery, ONIE makes HTTP requests for a series of
default installer image file names as described in
<a class="reference internal" href="../design-spec/discovery.html#default-file-name"><span class="std std-ref">Default File Name Search Order</span></a>.</p>
<p>Next, ONIE applies the default file name conventions, then it makes
the following HTTP requests looking for an installer image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.10</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">powerpc</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.10</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">powerpc</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.10</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.10</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">powerpc</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.10</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the exact file names used for your specific hardware
platform please contact your NOS vendor or your hardware
vendor.</p>
</div>
<p>A simple way to configure the Web server is to symlink (or rename) the
NOS vendor’s image name to one of the default ONIE installer file
names.  The symlink technique is shown here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>image-server:~$ cd /var/www
image-server:/var/www$ sudo ln -s ACME_XYZ1234_PowerPC_Installer.bin ./onie-installer
image-server:/var/www$ ls -l
lrwxrwxrwx 1 root root  104 Jul 22 14:01 onie-installer -&gt; ACME_XYZ1234_PowerPC_Installer.bin
</pre></div>
</div>
<p>With the symlink in place, the Web server hands back the full
installer image in response to the request for <code class="docutils literal notranslate"><span class="pre">onie-installer</span></code>.
Now ONIE can download and run the installer image.</p>
</div>
<div class="section" id="l2-connected-scenario">
<h2>L2 Connected  Scenario<a class="headerlink" href="#l2-connected-scenario" title="Permalink to this headline">¶</a></h2>
<p>In this topology, the target switch and the Web server are both in the
same layer 2 network. For example, they might both be plugged into the
same unmanaged switch. This is depicted in the following diagram.</p>
<div class="figure align-center" id="id18">
<a class="reference internal image-reference" href="../_images/l2-connect.png"><img alt="Switch and Web Server on Same L2 Network" src="../_images/l2-connect.png" style="width: 449.25px; height: 190.5px;" /></a>
<p class="caption"><span class="caption-text">Switch and Web Server on Same L2 Network</span></p>
</div>
<p>This scenario proceeds just like the <a class="reference internal" href="#directly-connected"><span class="std std-ref">Directly Connected Scenario</span></a>
described previously.  ONIE discovers the IP address of the Web server
and tries to download a series of default file names from the server.</p>
</div>
<div class="section" id="basic-dhcp-scenario-1-specify-installer-image-url">
<span id="basic-dhcp-1"></span><h2>Basic DHCP Scenario 1 (Specify Installer Image URL)<a class="headerlink" href="#basic-dhcp-scenario-1-specify-installer-image-url" title="Permalink to this headline">¶</a></h2>
<p>In this scenario we jump up one level in sophistication and use a DHCP
server to provide more specific information about the location of the
installer image.  The DHCP server, target switch and Web server are
all located on the same layer 2 network.  This is depicted in the
following diagram.</p>
<div class="figure align-center" id="id19">
<a class="reference internal image-reference" href="../_images/dhcp.png"><img alt="Switch and Web Server on Same L2 Network with DHCP Server" src="../_images/dhcp.png" style="width: 450.0px; height: 304.5px;" /></a>
<p class="caption"><span class="caption-text">Switch and Web Server on Same L2 Network with DHCP Server</span></p>
</div>
<p>The DHCP server provides the following information:</p>
<ul class="simple">
<li>IP address for the target switch from a pool of IP addresses</li>
<li>URL of the installer image on the Web server</li>
</ul>
<p>Below is a sample from a <code class="docutils literal notranslate"><span class="pre">dhcpd.conf</span></code> file for an ISC DHCP server
<a class="footnote-reference" href="#isc-dhcp" id="id6">[1]</a> <a class="footnote-reference" href="#isc-dhcp-options" id="id7">[2]</a>.  For more information on how ONIE
uses DHCP options, see the <a class="reference internal" href="../design-spec/discovery.html#onie-dhcp-requests"><span class="std std-ref">DHCP Requests and Responses</span></a> section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subnet</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.0</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="p">{</span>
  <span class="nb">range</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.20</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.200</span><span class="p">;</span>
  <span class="n">option</span> <span class="n">default</span><span class="o">-</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://203.0.113.10/customer-abc-onie-installer&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With this configuration ONIE picks up an IP address from the pool
defined by the <code class="docutils literal notranslate"><span class="pre">range</span></code> parameter.  ONIE next attempts to download
the URL specified by the <code class="docutils literal notranslate"><span class="pre">default-url</span></code> parameter.</p>
<p>With this technique you can:</p>
<ul class="simple">
<li>Assign whatever IP addresses make sense for your network.</li>
<li>Name the installer image whatever you want, including
sub-directories.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this example the Web server and target switch must be on
the same layer 2 network.</p>
</div>
</div>
<div class="section" id="basic-dhcp-scenario-2-domain-name-server">
<span id="basic-dhcp-2"></span><h2>Basic DHCP Scenario 2 (Domain Name Server)<a class="headerlink" href="#basic-dhcp-scenario-2-domain-name-server" title="Permalink to this headline">¶</a></h2>
<p>This scenario is just like <a class="reference internal" href="#basic-dhcp-1"><span class="std std-ref">Basic DHCP Scenario 1 (Specify Installer Image URL)</span></a> with the addition of a
domain name server (DNS).  By introducing a domain name server you can
use logical names for the Web server, without using hard-coded IP
addresses.</p>
<p>To add support for DNS, specify the <code class="docutils literal notranslate"><span class="pre">domain-name-servers</span></code> DHCP
option in the <code class="docutils literal notranslate"><span class="pre">dhcpd.conf</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subnet</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.0</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="p">{</span>
  <span class="nb">range</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.20</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.200</span><span class="p">;</span>
  <span class="n">option</span> <span class="n">domain</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">servers</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.2</span><span class="p">;</span>
  <span class="n">option</span> <span class="n">default</span><span class="o">-</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://image-server/customer-abc-onie-installer&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The domain name server is 203.0.113.2.  ONIE uses this server to
resolve the IP address for the hostname <code class="docutils literal notranslate"><span class="pre">image-server</span></code>.</p>
</div>
<div class="section" id="layer-3-network-scenario">
<h2>Layer 3 Network Scenario<a class="headerlink" href="#layer-3-network-scenario" title="Permalink to this headline">¶</a></h2>
<p>This scenario picks up where the <a class="reference internal" href="#basic-dhcp-2"><span class="std std-ref">Basic DHCP Scenario 2 (Domain Name Server)</span></a> left off and adds
router information to the DHCP configuration.  In this scenario the
target switch traverses a layer 3 network via a gateway to reach the
Web server.  The network topology is shown in the following diagram.</p>
<div class="figure align-center" id="id20">
<a class="reference internal image-reference" href="../_images/l3-connect.png"><img alt="Switch and Web Server on Different L3 Networks with DHCP Server" src="../_images/l3-connect.png" style="width: 485.25px; height: 345.0px;" /></a>
<p class="caption"><span class="caption-text">Switch and Web Server on Different L3 Networks with DHCP Server</span></p>
</div>
<p>With this setup, the Web server and target switch can reside on
different subnets.  The target switch needs to send packets via a
router to reach the Web server, since the machines are on different
subnets.</p>
<p>To specify a router for the target switch, in the DHCP configuration, set
the <code class="docutils literal notranslate"><span class="pre">routers</span></code> option to the IP address of the router:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subnet</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.0</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="p">{</span>
  <span class="nb">range</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.20</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.200</span><span class="p">;</span>
  <span class="n">option</span> <span class="n">domain</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">servers</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.2</span><span class="p">;</span>
  <span class="n">option</span> <span class="n">routers</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.3</span><span class="p">;</span>
  <span class="n">option</span> <span class="n">default</span><span class="o">-</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://image-server/customer-abc-onie-installer&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When requesting the installer image, the target switch sends packets to
203.0.113.3, which then forwards the packets to the next hop in the
layer 3 network.  Ultimately the packets reach the Web server and it
replies with the installer image.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For this scenario, the DHCP server must be in the same layer
2 network as the target switch.  The Web server is free to
reside in any subnet reachable by the router.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can use BOOTP relay agents <a class="footnote-reference" href="#bootp-relay" id="id8">[9]</a> to locate your
DHCP server on a different layer 2 network.  Configuration
of BOOTP realy agents is beyond the scope of this document.</p>
</div>
</div>
<div class="section" id="advanced-dhcp-match-vendor-class-identifier">
<span id="dhcp-debug"></span><h2>Advanced DHCP (Match Vendor Class Identifier)<a class="headerlink" href="#advanced-dhcp-match-vendor-class-identifier" title="Permalink to this headline">¶</a></h2>
<p>When ONIE makes a DHCP request, it sets the DHCP vendor class
(option 60) to a particular string.  See <a class="reference internal" href="../design-spec/discovery.html#onie-dhcp-vendor-class"><span class="std std-ref">Vendor Class Identifier – Option 60</span></a>
for more on how the DHCP vendor class is set.  Using our example
PowerPC machine, the string would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onie_vendor</span><span class="p">:</span><span class="n">powerpc</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the exact DHCP Vendor Class Identifier used for your
specific hardware platform please contact your NOS vendor or
your hardware vendor.</p>
</div>
<p>The ISC DHCP server configuration file syntax contains basic string
matching functionality that we can use to identify ONIE DHCP requests.
By parsing this string, an appropriate image URL can be returned by the
<code class="docutils literal notranslate"><span class="pre">default-url</span></code> DHCP option <a class="footnote-reference" href="#dhcp-eval" id="id9">[7]</a> <a class="footnote-reference" href="#dhcp-options" id="id10">[8]</a>.</p>
<p>The following DHCP stanzas differentiate between PowerPC ONIE-enabled
switches from example vendors <strong>VendorX</strong> and <strong>VendorY</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class &quot;onie-vendor-X-class&quot; {
  match if substring(option vendor-class-identifier, 0, 27) = &quot;onie_vendor:powerpc-VendorX&quot;;
  option default-url = &quot;http://image-server/VendorX-onie-installer&quot;;
}

class &quot;onie-vendor-Y-class&quot; {
  match if substring(option vendor-class-identifier, 0, 27) = &quot;onie_vendor:powerpc-VendorY&quot;;
  option default-url = &quot;http://image-server/VendorY-onie-installer&quot;;
}
</pre></div>
</div>
<p>In this case the DHCP server hands back different URLs depending on
the <code class="docutils literal notranslate"><span class="pre">vendor-class-identifier</span></code> option.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When debugging such constructs you may find it useful to
sprinkle in some DHCP logging directives.  For example, the
following <code class="docutils literal notranslate"><span class="pre">log()</span></code> directive placed <strong>outside</strong> the class stanza
can help you understand what is going on:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">concat</span><span class="p">(</span><span class="s2">&quot;vendor-class: &quot;</span><span class="p">,</span> <span class="n">substring</span><span class="p">(</span><span class="n">option</span> <span class="n">vendor</span><span class="o">-</span><span class="n">class</span><span class="o">-</span><span class="n">identifier</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">)));</span>
<span class="n">log</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">concat</span><span class="p">(</span><span class="s2">&quot;platform    : &quot;</span><span class="p">,</span> <span class="n">substring</span><span class="p">(</span><span class="n">option</span> <span class="n">vendor</span><span class="o">-</span><span class="n">class</span><span class="o">-</span><span class="n">identifier</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">999</span><span class="p">)));</span>
</pre></div>
</div>
<p>The first <code class="docutils literal notranslate"><span class="pre">log()</span></code> displays the first 11 characters of the
<code class="docutils literal notranslate"><span class="pre">vendor-class-identifier</span></code>, which should be the string
<code class="docutils literal notranslate"><span class="pre">onie_vendor</span></code>.  The 2nd <code class="docutils literal notranslate"><span class="pre">log()</span></code> displays the remaining
characters.</p>
<p class="last">Once everything is working you can remove the logging.</p>
</div>
</div>
<div class="section" id="advanced-dhcp-2-vivso">
<h2>Advanced DHCP 2 (VIVSO)<a class="headerlink" href="#advanced-dhcp-2-vivso" title="Permalink to this headline">¶</a></h2>
<p>As an alternative to string matching on the <code class="docutils literal notranslate"><span class="pre">vendor-class-identifier</span></code>,
ONIE also sends a Vendor-Identifying Vendor-Specific Information
Option (VIVSO - DHCP option 125) <a class="footnote-reference" href="#dhcp-options" id="id11">[8]</a>.</p>
<p>The VIVSO method is a more precise method of identifying the target
switch, however, this method also requires a bit more configuration on
the DHCP server.</p>
<p>For more information on how ONIE uses VIVSO, see <a class="reference internal" href="../design-spec/discovery.html#dhcp-vivso"><span class="std std-ref">Vendor-Identifying Vendor-Specific Information (VIVSO)</span></a>. Read
that now if you are interested in using VIVSO. (I mean it, go
now; we will wait for you to get back.)</p>
<p>The VIVSO option is bi-directional – the ONIE DHCP client sends the
option with identifying fields set and the DHCP server responds with
the URL field set.</p>
<p>VIVSO is nothing more than encapsulating vendor specific options
inside a standard DHCP option (option 125) <a class="footnote-reference" href="#rfc-3925" id="id12">[10]</a>.</p>
<p>In order for the ISC DHCP server to parse option 125, we have to define
the fields and data types to use.  Here is a snippet of the ISC DHCP server
configuration defining the fields that ONIE uses:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an option namespace called ONIE</span>
<span class="n">option</span> <span class="n">space</span> <span class="n">onie</span> <span class="n">code</span> <span class="n">width</span> <span class="mi">1</span> <span class="n">length</span> <span class="n">width</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1"># Define the code names and data types within the ONIE namespace</span>
<span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">installer_url</span> <span class="n">code</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>
<span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">updater_url</span>   <span class="n">code</span> <span class="mi">2</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>
<span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">machine</span>       <span class="n">code</span> <span class="mi">3</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>
<span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">arch</span>          <span class="n">code</span> <span class="mi">4</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>
<span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">machine_rev</span>   <span class="n">code</span> <span class="mi">5</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>

<span class="c1"># Package the ONIE namespace into option 125</span>
<span class="n">option</span> <span class="n">space</span> <span class="n">vivso</span> <span class="n">code</span> <span class="n">width</span> <span class="mi">4</span> <span class="n">length</span> <span class="n">width</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">option</span> <span class="n">vivso</span><span class="o">.</span><span class="n">onie</span> <span class="n">code</span> <span class="mi">42623</span> <span class="o">=</span> <span class="n">encapsulate</span> <span class="n">onie</span><span class="p">;</span>
<span class="n">option</span> <span class="n">vivso</span><span class="o">.</span><span class="n">iana</span> <span class="n">code</span> <span class="mi">0</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>
<span class="n">option</span> <span class="n">op125</span> <span class="n">code</span> <span class="mi">125</span> <span class="o">=</span> <span class="n">encapsulate</span> <span class="n">vivso</span><span class="p">;</span>
</pre></div>
</div>
<p><em>I told you this method required more configuration…</em></p>
<p>The number 42623 is a 32-bit IANA Enterprise Number used by ONIE to
identify its name space <a class="footnote-reference" href="#iana-number" id="id13">[11]</a>.  Since VIVSO allows for
multiple sets of vendor specific options, each set of options must be
uniquely identified by a IANA enterprise number.</p>
<p>The option space configuration should go into the <code class="docutils literal notranslate"><span class="pre">dhcpd.conf</span></code> file
at the <strong>global</strong> level, outside of any class definitions.</p>
<p>Now, with the option space defined, we can use the definitions when
receiving a VIVSO option.  Here is a snippet using the option space
definitions to inspect the target switch architecture and machine
type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class &quot;onie-vendor-classes&quot; {
  # Limit the matching to a request we know originated from ONIE
  match if substring(option vendor-class-identifier, 0, 11) = &quot;onie_vendor&quot;;

  # Required to use VIVSO
  option vivso.iana 01:01:01;

  # generic CPU architecture matching
  if option onie.arch = &quot;powerpc&quot; {
    option onie.installer_url = &quot;http://image-server/generic-powerpc-onie-installer&quot;;
  }

  # matching on CPU architecture and machine type
  if option onie.arch = &quot;powerpc&quot; and option onie.machine = &quot;XYZ1234&quot; {
    option onie.installer_url = &quot;http://image-server/powerpc-xyz1234-onie-installer&quot;;
  }

  # The contents of an option can also be used to create the response text
  if exists onie.arch and exists onie.machine and exists onie.machine_rev {
    option onie.installer_url = concat(&quot;http://image-server/image-installer-&quot;,
                                     option onie.arch, &quot;-&quot;, option onie.machine,
                                     &quot;-r&quot;, option onie.machine_rev);
  }

  # When operating in ONIE &#39;update&#39; mode ONIE will check the
  # onie.updater_url response option
  if option onie.arch = &quot;powerpc&quot; and option onie.machine = &quot;XYZ1234&quot; {
    option onie.updater_url = &quot;http://image-server/onie-updater-VENDOR_XYZ1234-powerpc.bin&quot;;
  }

}
</pre></div>
</div>
<p>Whew!  Let’s go through this configuration and discuss what they mean.
First the <code class="docutils literal notranslate"><span class="pre">class</span></code> definition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class &quot;onie-vendor-classes&quot; {
  # Limit the matching to a request we know originated from ONIE
  match if substring(option vendor-class-identifier, 0, 11) = &quot;onie_vendor&quot;;
</pre></div>
</div>
<p>The idea here is to limit the subsequent matching to a request we know
originated from an ONIE-enabled machine.  This is really just a bit of
healthy paranoia.</p>
<p>Next, the <code class="docutils literal notranslate"><span class="pre">iana</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Required to use VIVSO</span>
<span class="n">option</span> <span class="n">vivso</span><span class="o">.</span><span class="n">iana</span> <span class="mi">01</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">01</span><span class="p">;</span>
</pre></div>
</div>
<p>This along with the option space <code class="docutils literal notranslate"><span class="pre">vivso</span></code> defined above is a workaround
to a known issue in ISC DHCP server.  Without this workaround, the server
will not send back an option 125 response <a class="footnote-reference" href="#vivso-workaround" id="id14">[12]</a>.</p>
<p>Next, the generic CPU architecture matching statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># generic CPU architecture matching</span>
<span class="k">if</span> <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;powerpc&quot;</span> <span class="p">{</span>
  <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">installer_url</span> <span class="o">=</span> <span class="s2">&quot;http://image-server/generic-powerpc-onie-installer&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is an example of comparing an option field to a string.  If the
string matches, then the <code class="docutils literal notranslate"><span class="pre">installer_url</span></code> in the response is set to the
specified string.</p>
<p>Next, using the request field values in the response field values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># The contents of an option can also be used to create the response text</span>
<span class="k">if</span> <span class="n">exists</span> <span class="n">onie</span><span class="o">.</span><span class="n">arch</span> <span class="ow">and</span> <span class="n">exists</span> <span class="n">onie</span><span class="o">.</span><span class="n">machine</span> <span class="ow">and</span> <span class="n">exists</span> <span class="n">onie</span><span class="o">.</span><span class="n">machine_rev</span> <span class="p">{</span>
  <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">installer_url</span> <span class="o">=</span> <span class="n">concat</span><span class="p">(</span><span class="s2">&quot;http://image-server/image-installer-&quot;</span><span class="p">,</span>
                                   <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span>
                                   <span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">machine_rev</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using the function <code class="docutils literal notranslate"><span class="pre">concat</span></code> you can piece together several strings
to form the fields of the response.  Use the <code class="docutils literal notranslate"><span class="pre">option</span></code> directive to
extract the strings from the request and use the results to create the
response.</p>
<p>For example in the above snippet assume <code class="docutils literal notranslate"><span class="pre">onie.arch</span> <span class="pre">=</span> <span class="pre">&quot;powerpc&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">onie.machine</span> <span class="pre">=</span> <span class="pre">&quot;XYZ1234&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">onie.machine_rev</span> <span class="pre">=</span> <span class="pre">&quot;2&quot;</span></code>. In this case,
<code class="docutils literal notranslate"><span class="pre">onie.installer_url</span></code> would be set to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onie</span><span class="o">.</span><span class="n">installer_url</span> <span class="o">=</span> <span class="s2">&quot;http://image-server/image-installer-powerpc-XYZ1234-r2&quot;</span>
</pre></div>
</div>
<p>Finally, let’s look at the <code class="docutils literal notranslate"><span class="pre">updater_url</span></code> field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># When operating in ONIE &#39;update&#39; mode ONIE will check the</span>
<span class="c1"># onie.updater_url response option</span>
<span class="k">if</span> <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;powerpc&quot;</span> <span class="ow">and</span> <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">machine</span> <span class="o">=</span> <span class="s2">&quot;XYZ1234&quot;</span> <span class="p">{</span>
  <span class="n">option</span> <span class="n">onie</span><span class="o">.</span><span class="n">updater_url</span> <span class="o">=</span> <span class="s2">&quot;http://image-server/onie-updater-VENDOR_XYZ1234-powerpc.bin&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ONIE can run in <em>self-update mode</em> where it looks for an ONIE update
URL.  The update URL is used to download an ONIE self-update binary,
which ONIE uses to update itself.</p>
<p>Everything we have discussed about installer image URLs applies to
ONIE updater URLs when ONIE runs in self-update mode.</p>
<p>See <a class="reference internal" href="../design-spec/updater.html#updating-onie"><span class="std std-ref">Updating ONIE</span></a> for more about ONIE self-update mode.</p>
</div>
<div class="section" id="http-headers-and-scripting">
<h2>HTTP Headers and Scripting<a class="headerlink" href="#http-headers-and-scripting" title="Permalink to this headline">¶</a></h2>
<p>When ONIE makes an HTTP request for an image a number of ONIE-specific
HTTP headers are sent.  The values of these headers could be used in
advanced deployments to taylor the provisioning.  The following
headers are set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ONIE</span><span class="o">-</span><span class="n">SERIAL</span><span class="o">-</span><span class="n">NUMBER</span><span class="p">:</span>
<span class="n">ONIE</span><span class="o">-</span><span class="n">ETH</span><span class="o">-</span><span class="n">ADDR</span><span class="p">:</span>
<span class="n">ONIE</span><span class="o">-</span><span class="n">VENDOR</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span>
<span class="n">ONIE</span><span class="o">-</span><span class="n">MACHINE</span><span class="p">:</span>
<span class="n">ONIE</span><span class="o">-</span><span class="n">MACHINE</span><span class="o">-</span><span class="n">REV</span><span class="p">:</span>
<span class="n">ONIE</span><span class="o">-</span><span class="n">ARCH</span><span class="p">:</span>
<span class="n">ONIE</span><span class="o">-</span><span class="n">OPERATION</span><span class="p">:</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../design-spec/discovery.html#http-headers"><span class="std std-ref">HTTP Requests and HTTP Headers</span></a> for more about these HTTP headers.</p>
<p>For exmaple, the image URL handed out by the DHPC server could be a
CGI script on the HTTP server.  The CGI script could use the headers,
like <code class="docutils literal notranslate"><span class="pre">ONIE-SERIAL-NUMBER</span></code> and <code class="docutils literal notranslate"><span class="pre">ONIE-ETH-ADDR</span></code>, to tie the
deployment together with an inventory control database.</p>
</div>
<div class="section" id="debugging-an-installation">
<h2>Debugging an Installation<a class="headerlink" href="#debugging-an-installation" title="Permalink to this headline">¶</a></h2>
<p>If you are having trouble with an ONIE based installation, here are a
few suggestions.</p>
<div class="section" id="verify-web-server-configuration">
<h3>Verify Web Server Configuration<a class="headerlink" href="#verify-web-server-configuration" title="Permalink to this headline">¶</a></h3>
<p>Are you able to download the image from the Web server using a Web
browser?  See <a class="reference internal" href="#test-http-server"><span class="std std-ref">Testing the NOS Installer Download from the HTTP Server</span></a>.</p>
</div>
<div class="section" id="try-direct-connection">
<h3>Try Direct Connection<a class="headerlink" href="#try-direct-connection" title="Permalink to this headline">¶</a></h3>
<p>Try connecting the Web server directly to the target switch as
described in <a class="reference internal" href="#directly-connected"><span class="std std-ref">Directly Connected Scenario</span></a>.</p>
</div>
<div class="section" id="inspect-dhcp-server-logs">
<h3>Inspect DHCP Server Logs<a class="headerlink" href="#inspect-dhcp-server-logs" title="Permalink to this headline">¶</a></h3>
<p>Try adding some logging to your DHCP server configuration as described
in <a class="reference internal" href="#dhcp-debug"><span class="std std-ref">Advanced DHCP (Match Vendor Class Identifier)</span></a>.</p>
<p>Also see if you server is handing out leases to the expected MAC
addresses.</p>
</div>
<div class="section" id="use-tcpdump">
<h3>Use TCPDUMP<a class="headerlink" href="#use-tcpdump" title="Permalink to this headline">¶</a></h3>
<p>If possible use <code class="docutils literal notranslate"><span class="pre">tcpdump</span></code> to inspect the network traffic on the DHCP
server <a class="footnote-reference" href="#tcpdump" id="id15">[13]</a>.  If you can gain root access to the DHCP server,
run the following <code class="docutils literal notranslate"><span class="pre">tcpdump</span></code> command to inspect the network traffic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dhcp</span><span class="o">-</span><span class="n">server</span><span class="p">:</span><span class="o">~</span> <span class="c1"># tcpdump -v -e -i &lt;intf&gt; ether host &lt;MAC address&gt;</span>
</pre></div>
</div>
<p>Replace &lt;intf&gt; with the network interface of the DHCP server that is
facing the target switch.  For example it might be ‘eth0’ or ‘eth1’.</p>
<p>Replace &lt;MAC address&gt; with the MAC address of the target switch’s
Ethernet management port.  You should be able to find the MAC address
on a label affixed to the outside of the switch.</p>
</div>
<div class="section" id="simplify-dhcp-configuration">
<h3>Simplify DHCP Configuration<a class="headerlink" href="#simplify-dhcp-configuration" title="Permalink to this headline">¶</a></h3>
<p>Try to trim down your DHCP configuration to the bare minimum.
Remember configuration within matching classes supersedes any global
scope configuration.</p>
</div>
<div class="section" id="add-a-remote-syslog-server">
<h3>Add a Remote Syslog Server<a class="headerlink" href="#add-a-remote-syslog-server" title="Permalink to this headline">¶</a></h3>
<p>ONIE can remotely log its progress to a <code class="docutils literal notranslate"><span class="pre">syslog</span></code> server.  If the DHCP
response contains a <code class="docutils literal notranslate"><span class="pre">log-servers</span></code> option, ONIE will remotely log to
that server.  Here is the ISC DHCP server syntax to specify a remote
syslog server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span> <span class="n">log</span><span class="o">-</span><span class="n">servers</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.2</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="log-in-to-the-target-switch">
<h3>Log In to the Target Switch<a class="headerlink" href="#log-in-to-the-target-switch" title="Permalink to this headline">¶</a></h3>
<p>If you can determine that ONIE is getting an IP address from the DHCP
server (look at the DHCP leases file) you can remotely log in to the
target switch using <code class="docutils literal notranslate"><span class="pre">ssh</span></code> or <code class="docutils literal notranslate"><span class="pre">telnet</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>linux:$ ssh root@203.0.113.22
The authenticity of host &#39;203.0.113.22 (203.0.113.22)&#39; can&#39;t be established.
RSA key fingerprint is 15:05:64:8a:c6:f3:5f:65:41:a6:10:f6:9d:43:9c:49.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;203.0.113.22&#39; (RSA) to the list of known hosts.
ONIE:~ #
</pre></div>
</div>
<p>ONIE does not require a password for either <code class="docutils literal notranslate"><span class="pre">ssh</span></code> or <code class="docutils literal notranslate"><span class="pre">telnet</span></code>.  Once
logged in you can inspect the ONIE log file <code class="docutils literal notranslate"><span class="pre">/var/log/onie.log</span></code> and
see what is happening:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ONIE</span><span class="p">:</span><span class="o">~</span> <span class="c1"># cat /var/log/onie.log</span>
</pre></div>
</div>
</div>
<div class="section" id="connect-to-the-serial-console">
<h3>Connect to the Serial Console<a class="headerlink" href="#connect-to-the-serial-console" title="Permalink to this headline">¶</a></h3>
<p>If all else fails, you can connect to the serial console of the target
switch.  ONIE uses a baud rate of 115200.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="isc-dhcp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[1]</a></td><td><a class="reference external" href="http://www.isc.org/downloads/dhcp/">ISC DHCP Server</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="isc-dhcp-options" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[2]</a></td><td><a class="reference external" href="http://www.ipamworldwide.com/dhcp-options/isc-dhcpv4-options.html">ISC DHCP Server Options</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="apache-httpd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[3]</a></td><td><a class="reference external" href="http://httpd.apache.org/">Apache httpd</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="nginx" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[4]</a></td><td><a class="reference external" href="http://nginx.org/">NGINX HTTP server</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="wget" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[5]</a></td><td><a class="reference external" href="http://linux.die.net/man/1/wget">wget http download</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="curl" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[6]</a></td><td><a class="reference external" href="http://linux.die.net/man/1/curl">curl http download</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="dhcp-eval" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[7]</a></td><td><a class="reference external" href="http://linux.die.net/man/5/dhcp-eval">dhcp-eval(5)</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="dhcp-options" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td><em>(<a class="fn-backref" href="#id10">1</a>, <a class="fn-backref" href="#id11">2</a>)</em> <a class="reference external" href="http://linux.die.net/man/5/dhcp-options">dhcp-options(5)</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="bootp-relay" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[9]</a></td><td><a class="reference external" href="http://tools.ietf.org/html/rfc2131.html">RFC-2131 and BOOTP Relay Agent</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="rfc-3925" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[10]</a></td><td><a class="reference external" href="http://tools.ietf.org/html/rfc3925">RFC-3925 and VIVSO</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="iana-number" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[11]</a></td><td><a class="reference external" href="http://www.iana.org/assignments/enterprise-numbers/enterprise-numbers">IANA Enterprise Number</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vivso-workaround" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id14">[12]</a></td><td><a class="reference external" href="https://lists.isc.org/pipermail/dhcp-users/2012-July/015793.html">VIVSO work around discussion thread</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="tcpdump" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id15">[13]</a></td><td><a class="reference external" href="http://linux.die.net/man/8/tcpdump">tcpdump - dump traffic on a network</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="../news/index.html" title="previous chapter (use the left arrow)">Project News</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="../design-spec/index.html" title="next chapter (use the right arrow)">Design Specification</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../design-spec/index.html" title="Design Specification"
             >next</a> |</li>
        <li class="right" >
          <a href="../news/index.html" title="Project News"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
        &copy; Copyright 2013-2018, <a href="https://cumulusnetworks.com/">Cumulus Networks, Inc.</a>  All Rights Reserved.
  </div>
  </body>
</html>