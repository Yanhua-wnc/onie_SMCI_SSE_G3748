
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Image Discovery and Execution &#8212; Open Network Install Environment  documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/onie-favicon-16x16.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Network Operating System Interface" href="nos_interface.html" />
    <link rel="prev" title="Linux Kernel Configuration" href="kernel.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="nos_interface.html" title="Network Operating System Interface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="kernel.html" title="Linux Kernel Configuration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Design Specification</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="operating_sw_design.html" accesskey="U">Operating Software Design</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
  <a href="
      ../index.html" class="logo">
  
  <img src="../_static/ONIE-logo-green-160x60.png" class="logo" />
  </a>
  <center><a href="https://github.com/opencomputeproject/onie" class="logo">
  <svg class="octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
  opencomputeproject/onie</a></center>

<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download/index.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design Specification</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_requirements.html">Switch Hardware Requirements</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="operating_sw_design.html">Operating Software Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="x86_arch_design.html">x86 CPU Architecture Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="uboot_arch_design.html">U-Boot Platform Architecture Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">Image Discovery and Execution</a><ul>
<li><a class="reference internal" href="#platform-name-and-identification">Platform Name and Identification</a></li>
<li><a class="reference internal" href="#installer-discovery-methods">Installer Discovery Methods</a><ul>
<li><a class="reference internal" href="#default-file-name-search-order">Default File Name Search Order</a></li>
<li><a class="reference internal" href="#static-configuration-method">Static Configuration Method</a></li>
<li><a class="reference internal" href="#local-file-system-method">Local File System Method</a></li>
<li><a class="reference internal" href="#ethernet-management-port-configuration">Ethernet Management Port Configuration</a></li>
<li><a class="reference internal" href="#dhcp-requests-and-responses">DHCP Requests and Responses</a><ul>
<li><a class="reference internal" href="#vendor-class-identifier-option-60">Vendor Class Identifier – Option 60</a></li>
<li><a class="reference internal" href="#user-class-option-77">User Class – Option 77</a></li>
<li><a class="reference internal" href="#vendor-identifying-vendor-specific-information-vivso">Vendor-Identifying Vendor-Specific Information (VIVSO)</a></li>
<li><a class="reference internal" href="#parameter-request-list-option-55">Parameter Request List – Option 55</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-requests-and-http-headers">HTTP Requests and HTTP Headers</a></li>
<li><a class="reference internal" href="#exact-installer-urls-from-dhcpv4">Exact Installer URLs From DHCPv4</a></li>
<li><a class="reference internal" href="#partial-installer-urls">Partial Installer URLs</a><ul>
<li><a class="reference internal" href="#default-onie-image-server-name-onie-server">Default ONIE image server name <code class="docutils literal notranslate"><span class="pre">onie-server</span></code></a></li>
<li><a class="reference internal" href="#tftp-waterfall">TFTP Waterfall</a></li>
<li><a class="reference internal" href="#http-ipv4-and-ipv6-neighbors">HTTP IPv4 and IPv6 Neighbors</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#execution-environment">Execution Environment</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Home</a></li>
              
                <li><a href="index.html">Design Specification</a></li>
              
                <li><a href="operating_sw_design.html">Operating Software Design</a></li>
              
              <li>Image Discovery and Execution</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="image-discovery-and-execution">
<span id="image-discovery"></span><h1>Image Discovery and Execution<a class="headerlink" href="#image-discovery-and-execution" title="Permalink to this headline">¶</a></h1>
<p>The primary responsibility of ONIE is to locate a network operating system
(NOS) installer and execute it.</p>
<div class="section" id="platform-name-and-identification">
<span id="platform-name"></span><h2>Platform Name and Identification<a class="headerlink" href="#platform-name-and-identification" title="Permalink to this headline">¶</a></h2>
<p>For identifying the running platform. ONIE uses the following definitions:</p>
<ul class="simple">
<li>arch – The CPU architecture.  The currently supported architectures are:<ul>
<li>arm</li>
<li>powerpc</li>
<li>x86_64</li>
</ul>
</li>
<li>machine – A string of the form <code class="docutils literal notranslate"><span class="pre">&lt;VENDOR&gt;_&lt;MODEL&gt;</span></code>.</li>
<li>machine-revision – A string of the form <code class="docutils literal notranslate"><span class="pre">r&lt;NUMBER&gt;</span></code>, used to track
different hardware revision of a machine</li>
<li>platform – A string of the form <code class="docutils literal notranslate"><span class="pre">&lt;ARCH&gt;-&lt;MACHINE&gt;-&lt;MACHINE-REVISION&gt;</span></code></li>
<li>switch-silicon-vendor – A string of one of the following, used to
track ASIC silicon vendor:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="70%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Silicon Vendor</th>
<th class="head">String</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Broadcom</td>
<td>bcm</td>
</tr>
<tr class="row-odd"><td>Cavium</td>
<td>cavium</td>
</tr>
<tr class="row-even"><td>Centec</td>
<td>centec</td>
</tr>
<tr class="row-odd"><td>Marvell</td>
<td>mvl</td>
</tr>
<tr class="row-even"><td>Mellanox</td>
<td>mlnx</td>
</tr>
<tr class="row-odd"><td>Nephos</td>
<td>nephos</td>
</tr>
<tr class="row-even"><td>Qemu</td>
<td>qemu</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above definitions place some restrictions on the valid
characters allowed for the &lt;ARCH&gt;, &lt;VENDOR&gt; and &lt;MODEL&gt;
strings.</p>
</div>
<p>The allowable characters in the above strings are:</p>
<ol class="arabic simple">
<li>VENDOR - cannot contain <code class="docutils literal notranslate"><span class="pre">_</span></code> (underscore) or <code class="docutils literal notranslate"><span class="pre">-</span></code> (hyphen) characters</li>
<li>MODEL  - cannot contain <code class="docutils literal notranslate"><span class="pre">-</span></code> (hyphen) character.  <code class="docutils literal notranslate"><span class="pre">_</span></code>
(underscore) is OK</li>
<li>ARCH   - cannot contain <code class="docutils literal notranslate"><span class="pre">_</span></code> (underscore) or <code class="docutils literal notranslate"><span class="pre">-</span></code> (hyphen) characters</li>
</ol>
<p>At runtime, ONIE provides the <code class="docutils literal notranslate"><span class="pre">onie-sysinfo</span></code> command, which can be
used to dump this information and more.  See the
<a class="reference internal" href="nos_interface.html#cmd-onie-sysinfo"><span class="std std-ref">System Information</span></a> section for more about the <code class="docutils literal notranslate"><span class="pre">onie-sysinfo</span></code>
command.</p>
<p>The platform name must remain consistent across all ONIE modes as
described in <a class="reference internal" href="nos_interface.html#nos-interface"><span class="std std-ref">Network Operating System Interface</span></a>.</p>
</div>
<div class="section" id="installer-discovery-methods">
<span id="installer-discovery"></span><h2>Installer Discovery Methods<a class="headerlink" href="#installer-discovery-methods" title="Permalink to this headline">¶</a></h2>
<p>ONIE attempts to locate the installer through a number of discovery
methods.  The first successful method found is used to download and
run an installer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even though an installer is successfully found, the
installer can fail, in which case ONIE moves on to the next discovery
method.</p>
</div>
<p>The following methods are tried in this order:</p>
<ol class="arabic simple">
<li>Statically configured (passed from boot loader)</li>
<li>Local file systems (USB for example)</li>
<li>Exact URLs from DHCPv4</li>
<li>Inexact URLs based on DHCP responses</li>
<li>IPv6 neighbors</li>
<li>TFTP waterfall</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The discovery methods are tried repeatedly, forever, until a
successful image install occurs.</p>
</div>
<p>The general image discovery procedure is illustrated by this
pseudo-code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="n">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Configure</span> <span class="n">Ethernet</span> <span class="n">management</span> <span class="n">console</span>
  <span class="n">Attempt</span> <span class="n">discovery</span> <span class="n">method</span> <span class="mi">1</span>
  <span class="n">Attempt</span> <span class="n">discovery</span> <span class="n">method</span> <span class="mi">2</span>
  <span class="o">...</span>
  <span class="n">Attempt</span> <span class="n">discovery</span> <span class="n">method</span> <span class="n">N</span>
  <span class="n">Sleep</span> <span class="k">for</span> <span class="mi">20</span> <span class="n">seconds</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The subsequent sections describe these methods in detail.</p>
<div class="section" id="default-file-name-search-order">
<span id="default-file-name"></span><h3>Default File Name Search Order<a class="headerlink" href="#default-file-name-search-order" title="Permalink to this headline">¶</a></h3>
<p>In a number of the following methods, ONIE searches for default file
names in a specific order.  All the methods use the same default file
names and search order, which are described in this section.</p>
<p>The default installer file names are searched for in the following order:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;-r&lt;machine_revision&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;-r&lt;machine_revision&gt;.bin</span></code> *</li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;.bin</span></code> *</li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;vendor&gt;_&lt;machine&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;vendor&gt;_&lt;machine&gt;.bin</span></code> *</li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;cpu_arch&gt;-&lt;switch_silicon_vendor&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;cpu_arch&gt;-&lt;switch_silicon_vendor&gt;.bin</span></code> *</li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;arch&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;arch&gt;.bin</span></code> *</li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">onie-installer.bin</span></code> *</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ONIE 2017.08 added the <code class="docutils literal notranslate"><span class="pre">.bin</span></code> extension to all the default file
names.  Previous ONIE versions do not look for file names with the
<code class="docutils literal notranslate"><span class="pre">.bin</span></code> extension.</p>
</div>
<p>For a hypothetical x86_64 machine, the default installer file names
would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span><span class="o">.</span><span class="n">bin</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">.</span><span class="n">bin</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">.</span><span class="n">bin</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">SWITCH_SILICON_VENDOR</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">SWITCH_SILICON_VENDOR</span><span class="o">.</span><span class="n">bin</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">bin</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ONIE 2016.05 introduced
<code class="docutils literal notranslate"><span class="pre">onie-installer-&lt;cpu_arch&gt;-&lt;switch_silicon_vendor&gt;</span></code>.  All previous
ONIE versions do not include this naming item.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the case of ONIE <em>self-update mode</em>, the file name prefix is
<code class="docutils literal notranslate"><span class="pre">onie-updater</span></code> instead of <code class="docutils literal notranslate"><span class="pre">onie-installer</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the exact file names used for your specific hardware
platform please contact your NOS vendor or your hardware
vendor.</p>
</div>
</div>
<div class="section" id="static-configuration-method">
<h3>Static Configuration Method<a class="headerlink" href="#static-configuration-method" title="Permalink to this headline">¶</a></h3>
<p>This method is intended for engineering use only; for example, during
the porting of ONIE to a new platform.  In the boot loader, the user
can statically configure an installer URL that ONIE will use by
setting the <code class="docutils literal notranslate"><span class="pre">install_url</span></code> kernel command line argument.</p>
</div>
<div class="section" id="local-file-system-method">
<h3>Local File System Method<a class="headerlink" href="#local-file-system-method" title="Permalink to this headline">¶</a></h3>
<p>In this method, ONIE searches the partitions of locally attached
storage devices looking for one of the ONIE default installer file
names.</p>
<p>See <a class="reference internal" href="#default-file-name"><span class="std std-ref">Default File Name Search Order</span></a> for more information on the default file names.</p>
<p>This method is intended for the case where the NOS installer is
available on a USB memory stick plugged into the front panel.</p>
<p>Two file system types are supported, the popular <code class="docutils literal notranslate"><span class="pre">vFAT</span></code> partition type
(common on commercially availabe USB sticks) and Linux’s <code class="docutils literal notranslate"><span class="pre">ext2</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>OSX’s Disk Utility by default will write out an unsupported partition type.
Please use the <code class="docutils literal notranslate"><span class="pre">diskutil</span></code> command line tool for formatting:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find USB drive</span>

<span class="o">%</span> <span class="n">diskutil</span> <span class="nb">list</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk2</span>
   <span class="c1">#:                       TYPE NAME                    SIZE       IDENTIFIER</span>
   <span class="mi">0</span><span class="p">:</span>     <span class="n">FDisk_partition_scheme</span>                        <span class="o">*</span><span class="mf">8.1</span> <span class="n">GB</span>     <span class="n">disk2</span>
   <span class="mi">1</span><span class="p">:</span>               <span class="n">Windows_NTFS</span> <span class="n">ONIE</span>                    <span class="mf">8.1</span> <span class="n">GB</span>     <span class="n">disk2s1</span>

<span class="c1"># Write out correctly label (wipes all data on drive)</span>

<span class="o">%</span> <span class="n">sudo</span> <span class="n">diskutil</span> <span class="n">eraseDisk</span> <span class="n">FAT32</span> <span class="n">ONIE</span> <span class="n">MBRFormat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk2</span>
<span class="n">Started</span> <span class="n">erase</span> <span class="n">on</span> <span class="n">disk2</span>
<span class="n">Unmounting</span> <span class="n">disk</span>
<span class="n">Creating</span> <span class="n">the</span> <span class="n">partition</span> <span class="nb">map</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">the</span> <span class="n">disks</span> <span class="n">to</span> <span class="n">reappear</span>
<span class="n">Formatting</span> <span class="n">disk2s1</span> <span class="k">as</span> <span class="n">MS</span><span class="o">-</span><span class="n">DOS</span> <span class="p">(</span><span class="n">FAT32</span><span class="p">)</span> <span class="k">with</span> <span class="n">name</span> <span class="n">ONIE</span>
<span class="mi">512</span> <span class="nb">bytes</span> <span class="n">per</span> <span class="n">physical</span> <span class="n">sector</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">rdisk2s1</span><span class="p">:</span> <span class="mi">15697944</span> <span class="n">sectors</span> <span class="ow">in</span> <span class="mi">1962243</span> <span class="n">FAT32</span> <span class="n">clusters</span> <span class="p">(</span><span class="mi">4096</span> <span class="nb">bytes</span><span class="o">/</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">bps</span><span class="o">=</span><span class="mi">512</span> <span class="n">spc</span><span class="o">=</span><span class="mi">8</span> <span class="n">res</span><span class="o">=</span><span class="mi">32</span> <span class="n">nft</span><span class="o">=</span><span class="mi">2</span> <span class="n">mid</span><span class="o">=</span><span class="mh">0xf8</span> <span class="n">spt</span><span class="o">=</span><span class="mi">32</span> <span class="n">hds</span><span class="o">=</span><span class="mi">255</span> <span class="n">hid</span><span class="o">=</span><span class="mi">2</span> <span class="n">drv</span><span class="o">=</span><span class="mh">0x80</span> <span class="n">bsec</span><span class="o">=</span><span class="mi">15728638</span> <span class="n">bspf</span><span class="o">=</span><span class="mi">15331</span> <span class="n">rdcl</span><span class="o">=</span><span class="mi">2</span> <span class="n">infs</span><span class="o">=</span><span class="mi">1</span> <span class="n">bkbs</span><span class="o">=</span><span class="mi">6</span>
<span class="n">Mounting</span> <span class="n">disk</span>
<span class="n">Finished</span> <span class="n">erase</span> <span class="n">on</span> <span class="n">disk2</span>
</pre></div>
</div>
</div>
<p>The general algorithm for locating the installer on local storage
proceeds as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foreach $partition in /proc/partitions {
  if able to mount $partition then {
    if default file name exists {
      Add partition to found_list
    }
  }
}

foreach $partition in found_list {
  Run installer from $partition
}
</pre></div>
</div>
</div>
<div class="section" id="ethernet-management-port-configuration">
<span id="onie-eth-mgmt-config"></span><h3>Ethernet Management Port Configuration<a class="headerlink" href="#ethernet-management-port-configuration" title="Permalink to this headline">¶</a></h3>
<p>In order to perform network based image discovery the Ethernet
management console must first be configured.  The following
configuration methods are tried in order:</p>
<ol class="arabic simple">
<li>Static configuration – Set via the <code class="docutils literal notranslate"><span class="pre">ip</span></code> kernel command line argument</li>
<li>DHCPv6 – Planned, but not yet implemented</li>
<li>DHCPv4</li>
<li>Link Local IPv4 address (see <a class="reference external" href="https://tools.ietf.org/html/rfc3927">RFC-3927</a>)</li>
</ol>
<p>The static configuration uses the <code class="docutils literal notranslate"><span class="pre">ip</span></code> <a class="reference external" href="https://www.kernel.org/doc/Documentation/filesystems/nfs/nfsroot.txt">Linux kernel command line
argument</a>.</p>
</div>
<div class="section" id="dhcp-requests-and-responses">
<span id="onie-dhcp-requests"></span><h3>DHCP Requests and Responses<a class="headerlink" href="#dhcp-requests-and-responses" title="Permalink to this headline">¶</a></h3>
<p>DHCP provides a powerful and flexible mechanism for specifying the
installer URL exactly.  During the DHCP request, ONIE sets a number of
options to help the DHCP server determine an appropriate response.</p>
<p>The following options are set during the request:</p>
<table border="1" class="colwidths-given docutils" id="id17">
<caption><span class="caption-text">DHCP Request Options</span><a class="headerlink" href="#id17" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="13%" />
<col width="38%" />
<col width="38%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Name</th>
<th class="head">ISC option-name</th>
<th class="head">RFC</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>60</td>
<td>Vendor Class Identifier</td>
<td>vendor-class-identifier</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">RFC 2132</a></td>
</tr>
<tr class="row-odd"><td>77</td>
<td>User Class</td>
<td>user-class</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">RFC 2132</a></td>
</tr>
<tr class="row-even"><td>125</td>
<td>Vendor-Identifying Vendor-Specific Information</td>
<td>vivso</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc3925.txt">RFC 3925</a></td>
</tr>
<tr class="row-odd"><td>55</td>
<td>Parameter Request List</td>
<td>dhcp-parameter-request-list</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">RFC 2132</a></td>
</tr>
</tbody>
</table>
<div class="section" id="vendor-class-identifier-option-60">
<span id="onie-dhcp-vendor-class"></span><h4>Vendor Class Identifier – Option 60<a class="headerlink" href="#vendor-class-identifier-option-60" title="Permalink to this headline">¶</a></h4>
<p>The vendor class identifier option is the concatenation of two
strings, separated by the colon <code class="docutils literal notranslate"><span class="pre">:</span></code> character:</p>
<ol class="arabic simple">
<li>The static string <code class="docutils literal notranslate"><span class="pre">onie_vendor</span></code></li>
<li>&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;-r&lt;machine_revision&gt;</li>
</ol>
<p>For example, using the example x86_64 machine, the string would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onie_vendor</span><span class="p">:</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the exact DHCP Vendor Class Identifier used for your
specific hardware platform please contact your NOS vendor or
your hardware vendor.</p>
</div>
<p>See the <a class="reference internal" href="#platform-name"><span class="std std-ref">Platform Name and Identification</span></a> table for more about the platform name.</p>
</div>
<div class="section" id="user-class-option-77">
<h4>User Class – Option 77<a class="headerlink" href="#user-class-option-77" title="Permalink to this headline">¶</a></h4>
<p>The user class option is set to the static string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onie_dhcp_user_class</span>
</pre></div>
</div>
</div>
<div class="section" id="vendor-identifying-vendor-specific-information-vivso">
<span id="dhcp-vivso"></span><h4>Vendor-Identifying Vendor-Specific Information (VIVSO)<a class="headerlink" href="#vendor-identifying-vendor-specific-information-vivso" title="Permalink to this headline">¶</a></h4>
<p>The VIVSO option allows for custom option namespaces, where the
namespace is identified by the <a class="reference external" href="http://www.iana.org/assignments/enterprise-numbers">32-bit IANA Private Enterprise Number</a>.  ONIE
currently uses the enterprise number <code class="docutils literal notranslate"><span class="pre">42623</span></code> to identify its custom
namespace.</p>
<p>The option codes within the ONIE namespace have a size of 1 byte. The
option payload length is also 1 byte.</p>
<p>Within this namespace, the following option codes are defined:</p>
<span id="dhcp-vendor-options"></span><table border="1" class="colwidths-given docutils" id="id18">
<caption><span class="caption-text">VIVSO Options</span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="33%" />
<col width="17%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Code</th>
<th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Installer URL</td>
<td>string</td>
<td>http://10.0.1.205/nos_installer.bin</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Updater URL</td>
<td>string</td>
<td>http://10.0.1.205/onie_update.bin</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Platform Name</td>
<td>string</td>
<td>VENDOR_MACHINE</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>CPU Architecture</td>
<td>string</td>
<td>x86_64</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Machine Revision</td>
<td>string</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>See the <a class="reference internal" href="uboot_boot_loader.html#u-boot-platform-vars"><span class="std std-ref">Platform-Dependent Environment Variables</span></a> table for more information about the platform
name.</p>
</div>
<div class="section" id="parameter-request-list-option-55">
<h4>Parameter Request List – Option 55<a class="headerlink" href="#parameter-request-list-option-55" title="Permalink to this headline">¶</a></h4>
<p>The parameter request list option encodes a list of requested options.
ONIE requests the following options:</p>
<table border="1" class="colwidths-given docutils" id="id19">
<caption><span class="caption-text">DHCP Parameter Request List Options</span><a class="headerlink" href="#id19" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="22%" />
<col width="11%" />
<col width="11%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Name</th>
<th class="head">ISC option-name</th>
<th class="head">Option Type</th>
<th class="head">RFC</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Subnet Mask</td>
<td>subnet-mask</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>255.255.255.0</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>Default Gateway</td>
<td>routers</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-even"><td>6</td>
<td>Domain Server</td>
<td>domain-name-servers</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-odd"><td>7</td>
<td>Log Server</td>
<td>log-servers</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-even"><td>12</td>
<td>Hostname</td>
<td>host-name</td>
<td>&#160;</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>switch-19</td>
</tr>
<tr class="row-odd"><td>15</td>
<td>Domain Name</td>
<td>domain-name</td>
<td>string</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>cumulusnetworks.com</td>
</tr>
<tr class="row-even"><td>42</td>
<td>NTP Servers</td>
<td>ntp-servers</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-odd"><td>54</td>
<td>DHCP Server Identifier</td>
<td>dhcp-server-identifier</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-even"><td>66</td>
<td>TFTP Server Name</td>
<td>tftp-server-name</td>
<td>string</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>behemoth01 (requires DNS)</td>
</tr>
<tr class="row-odd"><td>67</td>
<td>TFTP Bootfile Name</td>
<td>bootfile-name or filename</td>
<td>string</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>tftp/installer.sh</td>
</tr>
<tr class="row-even"><td>72</td>
<td>HTTP Server IP</td>
<td>www-server</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.251</td>
</tr>
<tr class="row-odd"><td>114</td>
<td>Default URL</td>
<td>default-url</td>
<td>string</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc3679.txt">3679</a></td>
<td>http://server/path/installer</td>
</tr>
<tr class="row-even"><td>150</td>
<td>TFTP Server IP Address</td>
<td>next-server</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc5859.txt">5859</a></td>
<td>10.50.1.200</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="http-requests-and-http-headers">
<span id="http-headers"></span><h3>HTTP Requests and HTTP Headers<a class="headerlink" href="#http-requests-and-http-headers" title="Permalink to this headline">¶</a></h3>
<p>All HTTP requests made by ONIE include a set of standard HTTP headers,
which an HTTP CGI automation system could utilize.  The headers sent on
each HTTP request are:</p>
<table border="1" class="colwidths-given docutils" id="id20">
<caption><span class="caption-text">HTTP Headers</span><a class="headerlink" href="#id20" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Header</th>
<th class="head">Value</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ONIE-SERIAL-NUMBER:</td>
<td>Serial number</td>
<td>XYZ123004</td>
</tr>
<tr class="row-odd"><td>ONIE-ETH-ADDR:</td>
<td>Management MAC address</td>
<td>08:9e:01:62:d1:93</td>
</tr>
<tr class="row-even"><td>ONIE-VENDOR-ID:</td>
<td>32-bit IANA Private Enterprise Number in decimal</td>
<td>12345</td>
</tr>
<tr class="row-odd"><td>ONIE-MACHINE:</td>
<td>&lt;vendor&gt;_&lt;machine&gt;</td>
<td>VENDOR_MACHINE</td>
</tr>
<tr class="row-even"><td>ONIE-MACHINE-REV:</td>
<td>&lt;machine_revision&gt;</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>ONIE-ARCH:</td>
<td>CPU architecture</td>
<td>x86_64</td>
</tr>
<tr class="row-even"><td>ONIE-SECURITY-KEY:</td>
<td>Security key</td>
<td>d3b07384d-ac-6238ad5ff00</td>
</tr>
<tr class="row-odd"><td>ONIE-OPERATION:</td>
<td>ONIE mode of operation</td>
<td><code class="docutils literal notranslate"><span class="pre">os-install</span></code> or <code class="docutils literal notranslate"><span class="pre">onie-update</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="exact-installer-urls-from-dhcpv4">
<h3>Exact Installer URLs From DHCPv4<a class="headerlink" href="#exact-installer-urls-from-dhcpv4" title="Permalink to this headline">¶</a></h3>
<p>The DHCP options discussed previously provide a number of ways to
express the <strong>exact</strong> URL of the NOS installer.  When interpreting URLs,
ONIE accepts the following URI schemes:</p>
<ul class="simple">
<li>http://server/path/….</li>
<li>ftp://server/path/….</li>
<li>tftp://server/path/….</li>
</ul>
<p>The following options can be used to form an exact URL.</p>
<table border="1" class="colwidths-given docutils" id="id21">
<caption><span class="caption-text">Exact DHCP URLs</span><a class="headerlink" href="#id21" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Name</th>
<th class="head">Comments</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>125</td>
<td>VIVSO</td>
<td>The <em>installer URL</em> option (code = 1) specified in the ONIE VIVSO. Options yields an exact URL.  See <a class="reference internal" href="#dhcp-vivso"><span class="std std-ref">Vendor-Identifying Vendor-Specific Information (VIVSO)</span></a> above.</td>
</tr>
<tr class="row-odd"><td>114</td>
<td>Default URL</td>
<td>Intended for HTTP, but other URLs accepted.</td>
</tr>
<tr class="row-even"><td>150 + 67</td>
<td>TFTP server IP and TFTP bootfile</td>
<td>Both options required for an exact URL.</td>
</tr>
<tr class="row-odd"><td>66 + 67</td>
<td>TFTP server name and TFTP bootfile</td>
<td>Both options required for an exact URL.  Requires DNS.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="partial-installer-urls">
<span id="partial-install-urls"></span><h3>Partial Installer URLs<a class="headerlink" href="#partial-installer-urls" title="Permalink to this headline">¶</a></h3>
<p>Configuring a DHCP server for exact URLs may be impractical in certain
situations.</p>
<p>For example, consider an enterprise scenario where the corporate IT
department that controls the DHCP server is separate from the
application development department trying to prototype new Web
services.  The application department wants to move quickly and
prototype their new solution as soon as possible.  In this case,
waiting for the IT department to make DHCP server changes takes too much time.</p>
<p>To allow for flexibility in the administration of the DHCP server,
ONIE can find an installer using partial DHCP information.  ONIE uses
a default sequence of URL paths and default installer file names in
conjunction with partial DHCP information to find an installer.</p>
<p>See <a class="reference internal" href="#default-file-name"><span class="std std-ref">Default File Name Search Order</span></a> for more information on the default file
names and search order.</p>
<p>The following DHCP option responses are used to locate an installer in
conjunction with the default file names:</p>
<table border="1" class="colwidths-given docutils" id="id22">
<caption><span class="caption-text">Partial DHCP URLs</span><a class="headerlink" href="#id22" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DHCP Options</th>
<th class="head">Name</th>
<th class="head">URL</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>67</td>
<td>TFTP Bootfile</td>
<td>Contents of bootfile <a class="footnote-reference" href="#bootfile-url" id="id16">[1]</a></td>
</tr>
<tr class="row-odd"><td>72</td>
<td>HTTP Server IP</td>
<td>http://$http_server_ip/${onie_default_installer_names}</td>
</tr>
<tr class="row-even"><td>150</td>
<td>TFTP Server IP</td>
<td>http://$tftp_server_ip/${onie_default_installer_names}</td>
</tr>
<tr class="row-odd"><td>54</td>
<td>DHCP Server IP</td>
<td>http://$dhcp_server_ip/${onie_default_installer_names}</td>
</tr>
</tbody>
</table>
<div class="section" id="default-onie-image-server-name-onie-server">
<h4>Default ONIE image server name <code class="docutils literal notranslate"><span class="pre">onie-server</span></code><a class="headerlink" href="#default-onie-image-server-name-onie-server" title="Permalink to this headline">¶</a></h4>
<p>If the default ONIE server name <code class="docutils literal notranslate"><span class="pre">onie-server</span></code> is resolvable by DNS
it is included in the search for the default installer file names for
both <code class="docutils literal notranslate"><span class="pre">http</span></code> and <code class="docutils literal notranslate"><span class="pre">tftp</span></code> protocols.  The following URLs are
attempted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://onie-server/${onie_default_installer_names}
tftp://onie-server/${onie_default_installer_names}
</pre></div>
</div>
</div>
<div class="section" id="tftp-waterfall">
<h4>TFTP Waterfall<a class="headerlink" href="#tftp-waterfall" title="Permalink to this headline">¶</a></h4>
<p>ONIE includes a classic PXE-like TFTP waterfall.  Given a TFTP
server address, ONIE attempts to download the installer using a
sequence of TFTP paths with decreasing levels of specificity.</p>
<p>The TFTP URL name has this format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tftp://$tftp_server_ip/$path_prefix/$onie_default_installer_name
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">$tftp_server_ip</span></code> comes from DHCP option 66.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$path_prefix</span></code> is determined in the following manner:</p>
<ol class="arabic simple">
<li>First the <code class="docutils literal notranslate"><span class="pre">path_prefix</span></code> is built using the Ethernet management
interface’s MAC address using lower case hexadecimal with a dash
separator. For example, with address <code class="docutils literal notranslate"><span class="pre">55:66:AA:BB:CC:DD</span></code> the
<code class="docutils literal notranslate"><span class="pre">path_prefix</span></code> would be <code class="docutils literal notranslate"><span class="pre">55-66-aa-bb-cc-dd</span></code>.</li>
<li>Next, the <code class="docutils literal notranslate"><span class="pre">path_prefix</span></code> is built using the Ethernet management
interface’s IP address in upper case hexadecimal. For example,
<code class="docutils literal notranslate"><span class="pre">192.168.1.178</span> <span class="pre">-&gt;</span> <span class="pre">C0A801B2</span></code>.  If the installer is not found
at that location, remove the least significant hex digit and try again.</li>
<li>Finally, look for the list of default file names at the root of the TFTP server.</li>
</ol>
<p>Here is a complete list of the bootfile paths attempted using the
example MAC address, IP address and the example x86_64 platform:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">55</span><span class="o">-</span><span class="mi">66</span><span class="o">-</span><span class="n">aa</span><span class="o">-</span><span class="n">bb</span><span class="o">-</span><span class="n">cc</span><span class="o">-</span><span class="n">dd</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">C0A801B2</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">C0A801B</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">C0A801</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">C0A80</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">C0A8</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">C0A</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">C0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">C</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;-&lt;</span><span class="n">machine_revision</span><span class="o">&gt;</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">vendor</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">machine</span><span class="o">&gt;</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-&lt;</span><span class="n">arch</span><span class="o">&gt;</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#default-file-name"><span class="std std-ref">Default File Name Search Order</span></a> for more information on the default file
names and search order.</p>
</div>
<div class="section" id="http-ipv4-and-ipv6-neighbors">
<span id="discover-neighbors"></span><h4>HTTP IPv4 and IPv6 Neighbors<a class="headerlink" href="#http-ipv4-and-ipv6-neighbors" title="Permalink to this headline">¶</a></h4>
<p>ONIE queries its IPv4 and IPv6 link-local neighbors via HTTP for an
installer.  The general algorithm follows:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">ping</span></code> the IPv4 broadcast address, <code class="docutils literal notranslate"><span class="pre">255.255.255.255</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">ping6</span></code> the “all nodes” link local IPv6 multicast address, <code class="docutils literal notranslate"><span class="pre">ff02::1</span></code>.</li>
<li>For each responding neighbor, try to download the default file names
from the root of the HTTP server.</li>
</ol>
<p>Here is an example of the URLs used by this method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.14</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.14</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.14</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.14</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.14</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.75</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.75</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.75</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.75</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.75</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.108</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.108</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.108</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.108</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.108</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">139</span><span class="n">e</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">139</span><span class="n">e</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">139</span><span class="n">e</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">139</span><span class="n">e</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">139</span><span class="n">e</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2659</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2659</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2659</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2659</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">4638</span><span class="p">:</span><span class="mi">39</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2659</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">230</span><span class="p">:</span><span class="mi">48</span><span class="n">ff</span><span class="p">:</span><span class="n">fe9f</span><span class="p">:</span><span class="mi">1547</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">230</span><span class="p">:</span><span class="mi">48</span><span class="n">ff</span><span class="p">:</span><span class="n">fe9f</span><span class="p">:</span><span class="mi">1547</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">230</span><span class="p">:</span><span class="mi">48</span><span class="n">ff</span><span class="p">:</span><span class="n">fe9f</span><span class="p">:</span><span class="mi">1547</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">230</span><span class="p">:</span><span class="mi">48</span><span class="n">ff</span><span class="p">:</span><span class="n">fe9f</span><span class="p">:</span><span class="mi">1547</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">fe80</span><span class="p">::</span><span class="mi">230</span><span class="p">:</span><span class="mi">48</span><span class="n">ff</span><span class="p">:</span><span class="n">fe9f</span><span class="p">:</span><span class="mi">1547</span><span class="o">%</span><span class="n">eth0</span><span class="o">/</span><span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
</pre></div>
</div>
<p>This makes it very simple to walk up to a switch and directly connect
a laptop to the Ethernet management port and install from a local HTTP server.</p>
<p>See <a class="reference internal" href="#default-file-name"><span class="std std-ref">Default File Name Search Order</span></a> for more information on the default file
names and search order.</p>
</div>
</div>
</div>
<div class="section" id="execution-environment">
<h2>Execution Environment<a class="headerlink" href="#execution-environment" title="Permalink to this headline">¶</a></h2>
<p>After ONIE locates and downloads an installer, the next step is to run
the installer.</p>
<p>Prior to execution, ONIE prepares an execution environment:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">+x</span></code> on the downloaded installer.</li>
<li>Export a number of environment variables, usable by the installer.</li>
<li>Run the installer.</li>
</ul>
<p>ONIE exports the following environment variables:</p>
<table border="1" class="colwidths-given docutils" id="id23">
<caption><span class="caption-text">Installer Core Environment Variables</span><a class="headerlink" href="#id23" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable Name</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>onie_exec_url</td>
<td>Currently executing URL</td>
</tr>
<tr class="row-odd"><td>onie_platform</td>
<td>CPU architecture, vendor and machine name</td>
</tr>
<tr class="row-even"><td>onie_vendor_id</td>
<td>32-bit IANA Private Enterprise Number in decimal</td>
</tr>
<tr class="row-odd"><td>onie_serial_num</td>
<td>Device serial number</td>
</tr>
<tr class="row-even"><td>onie_eth_addr</td>
<td>MAC address for Ethernet management port</td>
</tr>
</tbody>
</table>
<p>In addition, any and all DHCP response options are exported, in the
style of BusyBox’s <code class="docutils literal notranslate"><span class="pre">udhcpc</span></code>.  A sample of those variables follows:</p>
<table border="1" class="colwidths-given docutils" id="id24">
<caption><span class="caption-text">Installer DHCP Environment Variables</span><a class="headerlink" href="#id24" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable Name</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>onie_disco_dns</td>
<td>DNS Server</td>
</tr>
<tr class="row-odd"><td>onie_disco_domain</td>
<td>Domain name from DNS</td>
</tr>
<tr class="row-even"><td>onie_disco_hostname</td>
<td>Switch hostname</td>
</tr>
<tr class="row-odd"><td>onie_disco_interface</td>
<td>Ethernet management interface, like eth0</td>
</tr>
<tr class="row-even"><td>onie_disco_ip</td>
<td>Ethernet management IP address</td>
</tr>
<tr class="row-odd"><td>onie_disco_router</td>
<td>Gateway</td>
</tr>
<tr class="row-even"><td>onie_disco_serverid</td>
<td>DHCP server IP</td>
</tr>
<tr class="row-odd"><td>onie_disco_siaddr</td>
<td>TFTP server IP</td>
</tr>
<tr class="row-even"><td>onie_disco_subnet</td>
<td>IP netmask</td>
</tr>
<tr class="row-odd"><td>onie_disco_vivso</td>
<td>VIVSO option data</td>
</tr>
</tbody>
</table>
<p>See <a class="reference internal" href="nos_interface.html#nos-interface"><span class="std std-ref">Network Operating System Interface</span></a> for more about the NOS installer.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="bootfile-url" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[1]</a></td><td>Try to intrepret the bootfile as a URL.  This is a
small abuse of the TFTP bootfile option, which has
a precedent in other loading schemes such as <a class="reference external" href="http://ipxe.org/howto/dhcpd">iPXE</a>.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="kernel.html" title="previous chapter (use the left arrow)">Linux Kernel Configuration</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="nos_interface.html" title="next chapter (use the right arrow)">Network Operating System Interface</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="nos_interface.html" title="Network Operating System Interface"
             >next</a> |</li>
        <li class="right" >
          <a href="kernel.html" title="Linux Kernel Configuration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Design Specification</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="operating_sw_design.html" >Operating Software Design</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
        &copy; Copyright 2013-2018, <a href="https://cumulusnetworks.com/">Cumulus Networks, Inc.</a>  All Rights Reserved.
  </div>
  </body>
</html>