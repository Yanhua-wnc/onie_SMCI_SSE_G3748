
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>U-Boot Platform NOS Interface Details &#8212; Open Network Install Environment  documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/onie-favicon-16x16.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Unit Testing" href="../testing/index.html" />
    <link rel="prev" title="U-Boot Platform Linux Kernel and Device Tree Source" href="uboot_kernel.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../testing/index.html" title="Unit Testing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="uboot_kernel.html" title="U-Boot Platform Linux Kernel and Device Tree Source"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Design Specification</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="uboot_arch_design.html" accesskey="U">U-Boot Platform Architecture Design</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
  <a href="
      ../index.html" class="logo">
  
  <img src="../_static/ONIE-logo-green-160x60.png" class="logo" />
  </a>
  <center><a href="https://github.com/opencomputeproject/onie" class="logo">
  <svg class="octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
  opencomputeproject/onie</a></center>

<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download/index.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design Specification</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_requirements.html">Switch Hardware Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="operating_sw_design.html">Operating Software Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="x86_arch_design.html">x86 CPU Architecture Design</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="uboot_arch_design.html">U-Boot Platform Architecture Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">U-Boot Platform NOS Interface Details</a><ul>
<li><a class="reference internal" href="#u-boot-platform-adding-kernel-command-arguments">U-Boot platform Adding Kernel Command Arguments</a></li>
<li><a class="reference internal" href="#u-boot-platform-nos-interface">U-Boot platform NOS Interface</a><ul>
<li><a class="reference internal" href="#u-boot-platform-nos-installer">U-Boot platform NOS Installer</a></li>
<li><a class="reference internal" href="#u-boot-platform-reinstalling-or-installing-a-different-nos">U-Boot platform Reinstalling or Installing a Different NOS</a></li>
<li><a class="reference internal" href="#u-boot-platform-nos-uninstall">U-Boot platform NOS Uninstall</a></li>
<li><a class="reference internal" href="#u-boot-platform-rescue-and-recovery">U-Boot platform Rescue and Recovery</a></li>
<li><a class="reference internal" href="#u-boot-platform-updating-and-embedding-onie">U-Boot platform Updating and Embedding ONIE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#u-boot-platform-hardware-diagnostics-interface-optional">U-Boot Platform Hardware Diagnostics Interface [Optional]</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Home</a></li>
              
                <li><a href="index.html">Design Specification</a></li>
              
                <li><a href="uboot_arch_design.html">U-Boot Platform Architecture Design</a></li>
              
              <li>U-Boot Platform NOS Interface Details</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="u-boot-platform-nos-interface-details">
<h1>U-Boot Platform NOS Interface Details<a class="headerlink" href="#u-boot-platform-nos-interface-details" title="Permalink to this headline">¶</a></h1>
<p>This section describes the U-Boot platform specific methods used to implement
the NOS interface.  See the <a class="reference internal" href="nos_interface.html#nos-interface"><span class="std std-ref">Network Operating System Interface</span></a> section for more
about the NOS interface.</p>
<div class="section" id="u-boot-platform-adding-kernel-command-arguments">
<h2>U-Boot platform Adding Kernel Command Arguments<a class="headerlink" href="#u-boot-platform-adding-kernel-command-arguments" title="Permalink to this headline">¶</a></h2>
<p>In the case of U-Boot and Linux, the user can set additional kernel
command line arguments by setting the <code class="docutils literal notranslate"><span class="pre">onie_debugargs</span></code> U-Boot
environment variable.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">install_url</span></code> kernel command line argument can be used to boot
into ONIE and automatically use the URL as an install URL.  For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">setenv</span> <span class="n">onie_debugargs</span> <span class="s1">&#39;install_url=http://10.0.1.249/nos_installer.bin&#39;</span>
<span class="o">=&gt;</span> <span class="n">run</span> <span class="n">onie_bootcmd</span>
</pre></div>
</div>
</div>
<div class="section" id="u-boot-platform-nos-interface">
<h2>U-Boot platform NOS Interface<a class="headerlink" href="#u-boot-platform-nos-interface" title="Permalink to this headline">¶</a></h2>
<p>On U-Boot platforms, ONIE communicates with the NOS via U-Boot
environment variables.  Both ONIE and the NOS must be able to read and
write U-Boot environment variables.  See the <a class="reference internal" href="nos_interface.html#nos-interface"><span class="std std-ref">Network Operating System Interface</span></a>
section for more about the NOS interface.</p>
<div class="section" id="u-boot-platform-nos-installer">
<span id="uboot-nos-intf-installer"></span><h3>U-Boot platform NOS Installer<a class="headerlink" href="#u-boot-platform-nos-installer" title="Permalink to this headline">¶</a></h3>
<p>The only requirement ONIE has for the NOS installer is that the NOS
<strong>must</strong> update the <code class="docutils literal notranslate"><span class="pre">nos_bootcmd</span></code> U-Boot environment variable
described in <a class="reference internal" href="uboot_boot_loader.html#platform-ind-vars"><span class="std std-ref">Platform-Independent Environment Variables</span></a>. This signals U-Boot to load the
NOS on subsequent boots, bypassing ONIE.</p>
<p>What goes into the <code class="docutils literal notranslate"><span class="pre">nos_bootcmd</span></code> is entirely up to the NOS vendor, but
generally it will contain commands to load and boot the NOS image from
NOR flash or from an SD card.</p>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-installer"><span class="std std-ref">NOS Installer</span></a> section for more about the NOS
installer interface.</p>
</div>
<div class="section" id="u-boot-platform-reinstalling-or-installing-a-different-nos">
<span id="uboot-nos-intf-reinstaller"></span><h3>U-Boot platform Reinstalling or Installing a Different NOS<a class="headerlink" href="#u-boot-platform-reinstalling-or-installing-a-different-nos" title="Permalink to this headline">¶</a></h3>
<p>To invoke the install operation, the running NOS sets the
<code class="docutils literal notranslate"><span class="pre">onie_boot_reason</span></code> U-Boot environment variable to the value
<code class="docutils literal notranslate"><span class="pre">install</span></code> (see <a class="reference internal" href="uboot_boot_loader.html#platform-ind-vars"><span class="std std-ref">Platform-Independent Environment Variables</span></a>), and then reboots the
system.  When the system starts up again, ONIE will see the
<code class="docutils literal notranslate"><span class="pre">onie_boot_reason</span></code> and restart the discovery and installation phase.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>From the U-Boot prompt, you can also boot ONIE into the discovery and
installation phase by typing:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">run</span> <span class="n">onie_bootcmd</span>
</pre></div>
</div>
</div>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-reinstaller"><span class="std std-ref">Reinstalling or Installing a Different NOS</span></a> section for more about the NOS
reinstaller interface.</p>
</div>
<div class="section" id="u-boot-platform-nos-uninstall">
<span id="uboot-nos-intf-uninstall"></span><h3>U-Boot platform NOS Uninstall<a class="headerlink" href="#u-boot-platform-nos-uninstall" title="Permalink to this headline">¶</a></h3>
<p>ONIE has an uninstall operation that wipes out the unused portions of
NOR flash and the attached mass storage device (like an SD card or USB NAND
flash). The only thing untouched is ONIE itself. This is a
“reset to factory defaults”-like operation.</p>
<p>To invoke the uninstall operation, the running NOS sets the
<code class="docutils literal notranslate"><span class="pre">onie_boot_reason</span></code> U-Boot environment variable to the value
<code class="docutils literal notranslate"><span class="pre">uninstall</span></code> (see <a class="reference internal" href="uboot_boot_loader.html#platform-ind-vars"><span class="std std-ref">Platform-Independent Environment Variables</span></a>), and then reboots the
system.  When the system starts up again, ONIE will see the
<code class="docutils literal notranslate"><span class="pre">onie_boot_reason</span></code> and start the uninstall process.</p>
<p>Following the uninstall process, the system returns to the
discovery and installation phase.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>From the U-Boot prompt you can also boot ONIE into the uninstall
mode by typing:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">run</span> <span class="n">onie_uninstall</span>
</pre></div>
</div>
</div>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-uninstall"><span class="std std-ref">NOS Uninstall</span></a> section for more about the NOS
uninstall interface.</p>
</div>
<div class="section" id="u-boot-platform-rescue-and-recovery">
<span id="uboot-nos-intf-rescue"></span><h3>U-Boot platform Rescue and Recovery<a class="headerlink" href="#u-boot-platform-rescue-and-recovery" title="Permalink to this headline">¶</a></h3>
<p>To invoke the rescue operation, the running NOS sets the <code class="docutils literal notranslate"><span class="pre">onie_boot_reason</span></code>
U-Boot environment variable to the value <code class="docutils literal notranslate"><span class="pre">rescue</span></code>
(see <a class="reference internal" href="uboot_boot_loader.html#platform-ind-vars"><span class="std std-ref">Platform-Independent Environment Variables</span></a>), and then reboots the system.  When the system
starts up again, ONIE will see the <code class="docutils literal notranslate"><span class="pre">onie_boot_reason</span></code> and enter rescue mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>From the U-Boot prompt you can also boot ONIE into rescue mode by
typing:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">run</span> <span class="n">onie_rescue</span>
</pre></div>
</div>
</div>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-rescue"><span class="std std-ref">Rescue and Recovery</span></a> section for more about the NOS rescue
interface.</p>
</div>
<div class="section" id="u-boot-platform-updating-and-embedding-onie">
<span id="uboot-nos-intf-update"></span><h3>U-Boot platform Updating and Embedding ONIE<a class="headerlink" href="#u-boot-platform-updating-and-embedding-onie" title="Permalink to this headline">¶</a></h3>
<p>On U-Boot platforms, only the <code class="docutils literal notranslate"><span class="pre">update</span></code> operation is supported; there
is no <code class="docutils literal notranslate"><span class="pre">embed</span></code> command for U-Boot platforms.  The <code class="docutils literal notranslate"><span class="pre">update</span></code>
operation is <strong>not</strong> descructive to the currently installed NOS.</p>
<p>The update operation installs a new version of ONIE in the NOR flash,
including:</p>
<ul class="simple">
<li>An updated U-Boot image</li>
<li>An updated ONIE kernel and initramfs</li>
</ul>
<p>To invoke the ONIE update operation, the running NOS sets the
<code class="docutils literal notranslate"><span class="pre">onie_boot_reason</span></code> U-Boot environment variable to the value
<code class="docutils literal notranslate"><span class="pre">update</span></code> (see <a class="reference internal" href="uboot_boot_loader.html#platform-ind-vars"><span class="std std-ref">Platform-Independent Environment Variables</span></a>), and then reboots the
system.  When the system starts up again, ONIE will see the
<code class="docutils literal notranslate"><span class="pre">onie_boot_reason</span></code> and enter ONIE self-update mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>From the U-Boot prompt you can also boot ONIE into ONIE self-update mode by
typing:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">run</span> <span class="n">onie_update</span>
</pre></div>
</div>
</div>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-update"><span class="std std-ref">Updating and Embedding ONIE</span></a> section for more about the NOS update
interface.</p>
</div>
</div>
<div class="section" id="u-boot-platform-hardware-diagnostics-interface-optional">
<span id="uboot-hw-diag"></span><h2>U-Boot Platform Hardware Diagnostics Interface [Optional]<a class="headerlink" href="#u-boot-platform-hardware-diagnostics-interface-optional" title="Permalink to this headline">¶</a></h2>
<p>This section describes a method for providing a hardware diagnostic
for U-Boot platforms.  See the <a class="reference internal" href="diag.html#hw-diag"><span class="std std-ref">Hardware Diagnostics [Optional]</span></a> section for more about
providing a hardware diagnostic.</p>
<p>The preferred storage location for the hardware diagnostic image is in
a NOR flash partition.  See the <a class="reference internal" href="uboot_kernel.html#nor-flash-partition"><span class="std std-ref">Boot Flash Partitioning</span></a> section for
more information on the NOR flash partitioning.</p>
<p>The diag image is located in the NOR flash in a specific <code class="docutils literal notranslate"><span class="pre">diag</span></code>
partition.  This allows the NOS installer to clearly identify the
partition and avoid overwriting it.</p>
<p>In order to boot the diagnostic image, the implementation must create
a new U-Boot environment variable called <code class="docutils literal notranslate"><span class="pre">boot_diag</span></code>.  This variable
contains all the U-Boot commands necessary to load and boot the
diagnostic image.</p>
<p>To invoke the diagnostic image the user would type <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">boot_diag</span></code>
from the U-Boot loader prompt.</p>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="uboot_kernel.html" title="previous chapter (use the left arrow)">U-Boot Platform Linux Kernel and Device Tree Source</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="../testing/index.html" title="next chapter (use the right arrow)">Unit Testing</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../testing/index.html" title="Unit Testing"
             >next</a> |</li>
        <li class="right" >
          <a href="uboot_kernel.html" title="U-Boot Platform Linux Kernel and Device Tree Source"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Design Specification</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="uboot_arch_design.html" >U-Boot Platform Architecture Design</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
        &copy; Copyright 2013-2018, <a href="https://cumulusnetworks.com/">Cumulus Networks, Inc.</a>  All Rights Reserved.
  </div>
  </body>
</html>