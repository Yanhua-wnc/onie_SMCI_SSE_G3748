
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>x86 Interface Details &#8212; Open Network Install Environment  documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/onie-favicon-16x16.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="x86 Initial Install and Recovery" href="x86_recovery.html" />
    <link rel="prev" title="x86 Linux Kernel and Integration" href="x86_kernel.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="x86_recovery.html" title="x86 Initial Install and Recovery"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="x86_kernel.html" title="x86 Linux Kernel and Integration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Design Specification</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="x86_arch_design.html" accesskey="U">x86 CPU Architecture Design</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
  <a href="
      ../index.html" class="logo">
  
  <img src="../_static/ONIE-logo-green-160x60.png" class="logo" />
  </a>
  <center><a href="https://github.com/opencomputeproject/onie" class="logo">
  <svg class="octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
  opencomputeproject/onie</a></center>

<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download/index.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design Specification</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_requirements.html">Switch Hardware Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="operating_sw_design.html">Operating Software Design</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="x86_arch_design.html">x86 CPU Architecture Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="uboot_arch_design.html">U-Boot Platform Architecture Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">x86 Interface Details</a><ul>
<li><a class="reference internal" href="#x86-nos-interface">x86 NOS Interface</a><ul>
<li><a class="reference internal" href="#x86-nos-installer">x86 NOS Installer</a></li>
<li><a class="reference internal" href="#x86-reinstalling-or-installing-a-different-nos">x86 Reinstalling or Installing a Different NOS</a></li>
<li><a class="reference internal" href="#x86-nos-uninstall">x86 NOS Uninstall</a></li>
<li><a class="reference internal" href="#x86-rescue-and-recovery">x86 Rescue and Recovery</a></li>
<li><a class="reference internal" href="#x86-updating-and-embedding-onie">x86 Updating and Embedding ONIE</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#x86-hardware-diagnostics-interface-optional">x86 Hardware Diagnostics Interface [Optional]</a><ul>
<li><a class="reference internal" href="#disk-partitioning">Disk Partitioning</a><ul>
<li><a class="reference internal" href="#gpt-partition-table">GPT Partition Table</a></li>
<li><a class="reference internal" href="#msdos-partition-table">MSDOS Partition Table</a></li>
</ul>
</li>
<li><a class="reference internal" href="#grub-considerations">GRUB Considerations</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Home</a></li>
              
                <li><a href="index.html">Design Specification</a></li>
              
                <li><a href="x86_arch_design.html">x86 CPU Architecture Design</a></li>
              
              <li>x86 Interface Details</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="x86-interface-details">
<h1>x86 Interface Details<a class="headerlink" href="#x86-interface-details" title="Permalink to this headline">¶</a></h1>
<p>This section describes the x86-specific methods used to implement the
NOS interface.  See the <a class="reference internal" href="nos_interface.html#nos-interface"><span class="std std-ref">Network Operating System Interface</span></a> section for more about
the NOS interface.</p>
<div class="section" id="x86-nos-interface">
<span id="cmd-onie-boot-mode"></span><span id="id1"></span><h2>x86 NOS Interface<a class="headerlink" href="#x86-nos-interface" title="Permalink to this headline">¶</a></h2>
<p>On x86 the NOS and ONIE communicate using GRUB environment variables
stored in the <code class="docutils literal notranslate"><span class="pre">ONIE-BOOT</span></code> partition.</p>
<p>ONIE provides a tool called <code class="docutils literal notranslate"><span class="pre">onie-boot-mode</span></code> that an NOS uses to set
the ONIE boot mode to one of:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">install</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">uninstall</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">rescue</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">update</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">embed</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">diag</span></code></li>
</ul>
<p>The complete help for the tool is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ONIE</span><span class="p">:</span><span class="o">/</span> <span class="c1"># onie-boot-mode -h</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">onie</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">mode</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">onie_mode</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">lhvq</span><span class="p">]</span>
<span class="n">Get</span> <span class="ow">or</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">default</span> <span class="n">GRUB</span> <span class="n">boot</span> <span class="n">entry</span><span class="o">.</span>  <span class="n">The</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">show</span>
<span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">entry</span><span class="o">.</span>

<span class="n">COMMAND</span> <span class="n">LINE</span> <span class="n">OPTIONS</span>

        <span class="o">-</span><span class="n">o</span>
                <span class="n">Set</span> <span class="n">the</span> <span class="n">default</span> <span class="n">GRUB</span> <span class="n">boot</span> <span class="n">entry</span> <span class="n">to</span> <span class="n">a</span> <span class="n">particular</span> <span class="s2">&quot;ONIE</span>
                <span class="n">mode</span><span class="s2">&quot;.  Available ONIE modes are:</span>

                <span class="n">install</span>   <span class="o">--</span> <span class="n">ONIE</span> <span class="n">OS</span> <span class="n">installer</span> <span class="n">mode</span>
                <span class="n">rescue</span>    <span class="o">--</span> <span class="n">ONIE</span> <span class="n">rescue</span> <span class="n">mode</span>
                <span class="n">uninstall</span> <span class="o">--</span> <span class="n">ONIE</span> <span class="n">OS</span> <span class="n">uninstall</span> <span class="n">mode</span>
                <span class="n">update</span>    <span class="o">--</span> <span class="n">ONIE</span> <span class="bp">self</span> <span class="n">update</span> <span class="n">mode</span>
                <span class="n">embed</span>     <span class="o">--</span> <span class="n">ONIE</span> <span class="bp">self</span> <span class="n">update</span> <span class="n">mode</span> <span class="ow">and</span> <span class="n">embed</span> <span class="n">ONIE</span>
                <span class="n">diag</span>      <span class="o">--</span> <span class="n">Hardware</span> <span class="n">Vendor</span><span class="s1">&#39;s Diagnostic</span>
                <span class="n">none</span>      <span class="o">--</span> <span class="n">Use</span> <span class="n">system</span> <span class="n">default</span> <span class="n">boot</span> <span class="n">mode</span>

                <span class="n">Some</span> <span class="n">platforms</span> <span class="n">may</span> <span class="n">offer</span> <span class="n">additional</span> <span class="n">modes</span><span class="o">.</span>  <span class="n">Check</span> <span class="k">with</span>
                <span class="n">your</span> <span class="n">hardware</span> <span class="n">vendor</span><span class="o">.</span>

                <span class="n">The</span> <span class="s1">&#39;none&#39;</span> <span class="n">mode</span> <span class="n">will</span> <span class="n">use</span> <span class="n">the</span> <span class="n">first</span> <span class="n">ONIE</span> <span class="n">boot</span> <span class="n">menu</span> <span class="n">entry</span><span class="o">.</span>

        <span class="o">-</span><span class="n">l</span>
                <span class="n">List</span> <span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">entry</span><span class="o">.</span>  <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">default</span><span class="o">.</span>

        <span class="o">-</span><span class="n">h</span>
                <span class="n">Help</span><span class="o">.</span>  <span class="n">Print</span> <span class="n">this</span> <span class="n">message</span><span class="o">.</span>

        <span class="o">-</span><span class="n">q</span>
                <span class="n">Quiet</span><span class="o">.</span>  <span class="n">No</span> <span class="n">printing</span><span class="p">,</span> <span class="k">except</span> <span class="k">for</span> <span class="n">errors</span><span class="o">.</span>

        <span class="o">-</span><span class="n">v</span>
                <span class="n">Be</span> <span class="n">verbose</span><span class="o">.</span>  <span class="n">Print</span> <span class="n">what</span> <span class="ow">is</span> <span class="n">happening</span><span class="o">.</span>
</pre></div>
</div>
<p>The tool is located in the <code class="docutils literal notranslate"><span class="pre">ONIE-BOOT</span></code> partition in the
<code class="docutils literal notranslate"><span class="pre">onie/tools/bin/onie-boot-mode</span></code> directory.  The NOS can easily mount
the <code class="docutils literal notranslate"><span class="pre">ONIE-BOOT</span></code> partition by using the disk volume label
<code class="docutils literal notranslate"><span class="pre">ONIE-BOOT</span></code>; for example, the following mounts the ONIE-BOOT partition from a
Linux-based NOS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># mkdir /mnt/onie-boot</span>
<span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># mount LABEL=ONIE-BOOT /mnt/onie-boot</span>
</pre></div>
</div>
<p>After that the <code class="docutils literal notranslate"><span class="pre">onie-boot-mode</span></code> tool is available in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># /mnt/onie-boot/onie/tools/bin/onie-boot-mode</span>
</pre></div>
</div>
<p>The tool is a thin wrapper around the <a class="reference external" href="http://man.he.net/man1/grub-editenv">grub-editenv</a> command that sets the
<code class="docutils literal notranslate"><span class="pre">onie_mode</span></code> variable to the desired value.</p>
<div class="section" id="x86-nos-installer">
<span id="x86-nos-intf-installer"></span><h3>x86 NOS Installer<a class="headerlink" href="#x86-nos-installer" title="Permalink to this headline">¶</a></h3>
<p>The main duties of an NOS installer on x86 are:</p>
<ul class="simple">
<li>Create partitions and format file systems</li>
<li>Install the NOS software in the new partitions</li>
<li>Install GRUB in the MBR</li>
<li>Set its GRUB configuration</li>
</ul>
<p>Installing GRUB and setting up the GRUB configuration are the most
important steps to describe here.</p>
<p>The walk through for installing GRUB and setting up the GRUB
configuration is described in the <a class="reference internal" href="x86_boot_loader.html#x86-boot-loader"><span class="std std-ref">x86 Legacy BIOS Boot Loader (GRUB2)</span></a> section.</p>
<p>Also the provided demo OS installer exercises all of the steps
described in this section.  See the <a class="reference internal" href="../developers/demo_os.html#demo-os"><span class="std std-ref">Demo OS Installer and OS Runtime</span></a> section for more
about the Demo OS.</p>
<p>In subsequent sections, the following assumptions about the NOS are made:</p>
<ol class="arabic simple">
<li>The NOS is Linux-based</li>
<li>The NOS has mounted the <code class="docutils literal notranslate"><span class="pre">ONIE-BOOT</span></code> partition read-write on
<code class="docutils literal notranslate"><span class="pre">/mnt/onie-boot</span></code></li>
<li>The NOS has created a GRUB menu entry named <code class="docutils literal notranslate"><span class="pre">ONIE</span></code> to chainload
into ONIE</li>
<li>The NOS has the <code class="docutils literal notranslate"><span class="pre">grub-reboot</span></code> command available</li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">grub-reboot</span></code> command allows the NOS’s GRUB to boot the ONIE
chainload entry once.  After one boot, the NOS’s GRUB will revert back
to the NOS default GRUB menu entry.</p>
</div>
<div class="section" id="x86-reinstalling-or-installing-a-different-nos">
<span id="x86-nos-intf-reinstaller"></span><h3>x86 Reinstalling or Installing a Different NOS<a class="headerlink" href="#x86-reinstalling-or-installing-a-different-nos" title="Permalink to this headline">¶</a></h3>
<p>To invoke the install operation, the NOS runs the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># grub-reboot ONIE</span>
<span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># /mnt/onie-boot/onie/tools/bin/onie-boot-mode -o install</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-reinstaller"><span class="std std-ref">Reinstalling or Installing a Different NOS</span></a> section for more about the NOS
reinstaller interface.</p>
</div>
<div class="section" id="x86-nos-uninstall">
<span id="x86-nos-intf-uninstall"></span><h3>x86 NOS Uninstall<a class="headerlink" href="#x86-nos-uninstall" title="Permalink to this headline">¶</a></h3>
<p>To invoke the uninstall operation, the NOS runs the following
commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># grub-reboot ONIE</span>
<span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># /mnt/onie-boot/onie/tools/bin/onie-boot-mode -o uninstall</span>
</pre></div>
</div>
<p>Following the uninstall process, the system returns to the
discovery and installation phase.</p>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-uninstall"><span class="std std-ref">NOS Uninstall</span></a> section for more about the NOS
uninstall interface.</p>
</div>
<div class="section" id="x86-rescue-and-recovery">
<span id="x86-nos-intf-rescue"></span><h3>x86 Rescue and Recovery<a class="headerlink" href="#x86-rescue-and-recovery" title="Permalink to this headline">¶</a></h3>
<p>To invoke the rescue operation, the NOS runs the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># grub-reboot ONIE</span>
<span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># /mnt/onie-boot/onie/tools/bin/onie-boot-mode -o rescue</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-rescue"><span class="std std-ref">Rescue and Recovery</span></a> section for more about the NOS rescue
interface.</p>
</div>
<div class="section" id="x86-updating-and-embedding-onie">
<span id="x86-nos-intf-update"></span><h3>x86 Updating and Embedding ONIE<a class="headerlink" href="#x86-updating-and-embedding-onie" title="Permalink to this headline">¶</a></h3>
<p>On x86 a distinction is made between the <code class="docutils literal notranslate"><span class="pre">update</span></code> operation and the
<code class="docutils literal notranslate"><span class="pre">embed</span></code> operation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">embed</span></code> operation is <strong>destructive</strong> and will wipe out
everything (including any installed NOS) and install a new version of
ONIE.  Typically this is done in manufacturing before the customer
receives the unit.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">update</span></code> operation is <strong>not</strong> destructive.  This operation will
only update the <code class="docutils literal notranslate"><span class="pre">ONIE-BOOT</span></code> partition.  Typically this would be used
in the field to update the current ONIE version, while leaving the
installed NOS intact.</p>
<p>To invoke the update operation, the NOS runs the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># grub-reboot ONIE</span>
<span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># /mnt/onie-boot/onie/tools/bin/onie-boot-mode -o update</span>
</pre></div>
</div>
<p>To invoke the embed operation, the NOS runs the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># grub-reboot ONIE</span>
<span class="n">NOS</span><span class="p">:</span><span class="o">/</span> <span class="c1"># /mnt/onie-boot/onie/tools/bin/onie-boot-mode -o embed</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="nos_interface.html#nos-intf-update"><span class="std std-ref">Updating and Embedding ONIE</span></a> section for more about the NOS update
interface.</p>
</div>
</div>
</div>
<div class="section" id="x86-hardware-diagnostics-interface-optional">
<span id="x86-hw-diag"></span><h1>x86 Hardware Diagnostics Interface [Optional]<a class="headerlink" href="#x86-hardware-diagnostics-interface-optional" title="Permalink to this headline">¶</a></h1>
<p>This section describes the method for providing a hardware diagnostic
for x86 platforms.  See the <a class="reference internal" href="diag.html#hw-diag"><span class="std std-ref">Hardware Diagnostics [Optional]</span></a> section for more about
providing a hardware diagnostic.</p>
<p>Installing the diag should be like installing a NOS.  Use the NOS
installer mechanism to install the diag image into its own partition.
This will allow hardware vendors to update the diag image
independently from ONIE.</p>
<p>All of the requirements specified in this section are illustrated by
the <code class="docutils literal notranslate"><span class="pre">Demo</span> <span class="pre">Diag</span> <span class="pre">OS</span></code>, which comes with the ONIE source code.  See the
<a class="reference internal" href="../developers/demo_diag.html#demo-diag-os"><span class="std std-ref">Demo Diagnostic OS Installer</span></a> section for more information.</p>
<div class="section" id="disk-partitioning">
<h2>Disk Partitioning<a class="headerlink" href="#disk-partitioning" title="Permalink to this headline">¶</a></h2>
<p>The diagnostic image resides on a hard disk partition.  This sections
describes properties of the disk partition.</p>
<div class="section" id="gpt-partition-table">
<h3>GPT Partition Table<a class="headerlink" href="#gpt-partition-table" title="Permalink to this headline">¶</a></h3>
<p>A diagnostic image installer on a GPT based machine must implement the
following:</p>
<ul class="simple">
<li>name the diag partition <code class="docutils literal notranslate"><span class="pre">&lt;SOMETHING&gt;-DIAG</span></code>.  See the <a class="reference external" href="http://www.rodsbooks.com/gdisk/sgdisk.html">sgdisk</a> program and the
<code class="docutils literal notranslate"><span class="pre">--change-name</span></code> option for details.  The <code class="docutils literal notranslate"><span class="pre">&lt;SOMETHING&gt;</span></code> can be
any string that makes sense for the hardware vendor.</li>
<li>set the GPT <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">partition</span></code> attribute bit (bit 0).  See the
<a class="reference external" href="http://www.rodsbooks.com/gdisk/sgdisk.html">sgdisk</a> program and
the <code class="docutils literal notranslate"><span class="pre">--attributes</span></code> option.</li>
<li>when creating the file system on the diag partition set the file
system label to <code class="docutils literal notranslate"><span class="pre">&lt;SOMETHING&gt;-DIAG</span></code>, the same string as used for
the GPT partition label.  See the <a class="reference external" href="http://linux.die.net/man/8/mkfs.ext4">mkfs.ext4</a> program and the <code class="docutils literal notranslate"><span class="pre">-L</span></code>
option.</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">-DIAG</span></code> suffix and the <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">partition</span></code> bit announces to ONIE
and ONIE compliant NOS installers that the partitions are <em>precious</em>
and should not be modified.</p>
<p>The ONIE <code class="docutils literal notranslate"><span class="pre">uninstall</span></code> operation must <em>not</em> remove or modify
partitions that meet the above requirements.</p>
<p>An ONIE compliant NOS must <em>not</em> remove or modify partitions that meet
the above requirements.</p>
</div>
<div class="section" id="msdos-partition-table">
<h3>MSDOS Partition Table<a class="headerlink" href="#msdos-partition-table" title="Permalink to this headline">¶</a></h3>
<p>For machines that use the MSDOS partition table, all we can do is use
the file system label. When creating the file system on the diag
partition set the file system label to <code class="docutils literal notranslate"><span class="pre">&lt;SOMETHING&gt;-DIAG</span></code>. See the
<a class="reference external" href="http://linux.die.net/man/8/mkfs.ext4">mkfs.ext4</a> program and the
<code class="docutils literal notranslate"><span class="pre">-L</span></code> option as an example.</p>
<p>The ONIE <code class="docutils literal notranslate"><span class="pre">uninstall</span></code> operation must <em>not</em> remove or modify
partitions that meet the above requirements.</p>
<p>An ONIE compliant NOS must <em>not</em> remove or modify partitions that meet
the above requirements.</p>
</div>
</div>
<div class="section" id="grub-considerations">
<h2>GRUB Considerations<a class="headerlink" href="#grub-considerations" title="Permalink to this headline">¶</a></h2>
<p>When installing the diagnostic image, install GRUB into the MBR, just
like a normal OS would do.</p>
<p>In addition, install GRUB into the diag partition.  This will allow a
NOS to <em>chainload</em> the diag OS with low friction.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">grub.cfg</span></code> for the diag partition must contain all the GRUB menu
entries the diag OS needs, plus one entry to chainload ONIE.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For ONIE versions up to and including 2015.11 the diagnostic image
installs GRUB into the MBR.  It is no longer recommended to install
GRUB into the MBR for the later versions.</p>
</div>
<p>If the diagnostic image is installed on versions older than 2015.11,
it should <em>only</em> install GRUB into the diag partition and <em>not</em> set
<code class="docutils literal notranslate"><span class="pre">ONIE</span></code> to be the default menu entry.  This makes the boot order
between the GRUBs on ONIE and diag OS be fixed.</p>
<p>If the diagnostic image is installed on versions newer than 2015.11,
it should <em>not</em> install GRUB into both the MBR and diag partition.
The later versions supports boot command feeded by diag installer.
This feature makes ONIE share GRUB with diag OS.  i.e., the diag
partition does not have its own GRUB instance and <code class="docutils literal notranslate"><span class="pre">grub.cfg</span></code>.  To
enable the feature, diag installer needs to be revised to meet the
function.  Please refer to the Demo diag installer in ONIE 2016.02.</p>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="x86_kernel.html" title="previous chapter (use the left arrow)">x86 Linux Kernel and Integration</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="x86_recovery.html" title="next chapter (use the right arrow)">x86 Initial Install and Recovery</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="x86_recovery.html" title="x86 Initial Install and Recovery"
             >next</a> |</li>
        <li class="right" >
          <a href="x86_kernel.html" title="x86 Linux Kernel and Integration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Design Specification</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="x86_arch_design.html" >x86 CPU Architecture Design</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
        &copy; Copyright 2013-2018, <a href="https://cumulusnetworks.com/">Cumulus Networks, Inc.</a>  All Rights Reserved.
  </div>
  </body>
</html>